



<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#FFF">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

<link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">


<link rel="alternate" type="application/rss+xml" title="Hexo" href="http://odiws.github.io/rss.xml" />
<link rel="alternate" type="application/atom+xml" title="Hexo" href="http://odiws.github.io/atom.xml" />
<link rel="alternate" type="application/json" title="Hexo" href="http://odiws.github.io/feed.json" />

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="/css/app.css?v=0.2.5">

  
  <meta name="keywords" content="buuctf,rust" />


<link rel="canonical" href="http://odiws.github.io/2025/03/28/rust%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">



  <title>
rust学习笔记 - 学习笔记 |
zty153’s_blog = Hexo</title>
<meta name="generator" content="Hexo 7.3.0"></head>
<body itemscope itemtype="http://schema.org/WebPage">
  <div id="loading">
    <div class="cat">
      <div class="body"></div>
      <div class="head">
        <div class="face"></div>
      </div>
      <div class="foot">
        <div class="tummy-end"></div>
        <div class="bottom"></div>
        <div class="legs left"></div>
        <div class="legs right"></div>
      </div>
      <div class="paw">
        <div class="hands left"></div>
        <div class="hands right"></div>
      </div>
    </div>
  </div>
  <div id="container">
    <header id="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="inner">
        <div id="brand">
          <div class="pjax">
          
  <h1 itemprop="name headline">rust学习笔记
  </h1>
  
<div class="meta">
  <span class="item" title="Created: 2025-03-28 19:58:38">
    <span class="icon">
      <i class="ic i-calendar"></i>
    </span>
    <span class="text">Posted on</span>
    <time itemprop="dateCreated datePublished" datetime="2025-03-28T19:58:38+08:00">2025-03-28</time>
  </span>
</div>


          </div>
        </div>
        <nav id="nav">
  <div class="inner">
    <div class="toggle">
      <div class="lines" aria-label="Toggle navigation bar">
        <span class="line"></span>
        <span class="line"></span>
        <span class="line"></span>
      </div>
    </div>
    <ul class="menu">
      <li class="item title"><a href="/" rel="start">zty153’s_blog</a></li>
    </ul>
    <ul class="right">
      <li class="item theme">
        <i class="ic i-sun"></i>
      </li>
      <li class="item search">
        <i class="ic i-search"></i>
      </li>
    </ul>
  </div>
</nav>

      </div>
      <div id="imgs" class="pjax">
        <ul>
          <li class="item" data-background-image="https://www.loliapi.com/acg/?264726"></li>
          <li class="item" data-background-image="https://www.loliapi.com/acg/?558622"></li>
          <li class="item" data-background-image="https://www.loliapi.com/acg/?596407"></li>
          <li class="item" data-background-image="https://www.loliapi.com/acg/?322601"></li>
          <li class="item" data-background-image="https://www.loliapi.com/acg/?638600"></li>
          <li class="item" data-background-image="https://www.loliapi.com/acg/?191122"></li>
        </ul>
      </div>
    </header>
    <div id="waves">
      <svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto">
        <defs>
          <path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z" />
        </defs>
        <g class="parallax">
          <use xlink:href="#gentle-wave" x="48" y="0" />
          <use xlink:href="#gentle-wave" x="48" y="3" />
          <use xlink:href="#gentle-wave" x="48" y="5" />
          <use xlink:href="#gentle-wave" x="48" y="7" />
        </g>
      </svg>
    </div>
    <main>
      <div class="inner">
        <div id="main" class="pjax">
          
  <div class="article wrap">
    
<div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList">
<i class="ic i-home"></i>
<span><a href="/">Home</a></span><i class="ic i-angle-right"></i>
<span  class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" itemprop="item" rel="index" title="In 学习笔记"><span itemprop="name">学习笔记</span></a>
<meta itemprop="position" content="1" /></span>
</div>

    <article itemscope itemtype="http://schema.org/Article" class="post block" lang="en">
  <link itemprop="mainEntityOfPage" href="http://odiws.github.io/2025/03/28/rust%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">

  <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="image" content="/images/avatar.jpg">
    <meta itemprop="name" content="odiws">
    <meta itemprop="description" content=", ">
  </span>

  <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Hexo">
  </span>

  <div class="body md" itemprop="articleBody">
    

    <h2 id="rust学习笔记"><a class="anchor" href="#rust学习笔记">#</a> Rust 学习笔记</h2>
<h3 id="变量声明"><a class="anchor" href="#变量声明">#</a> 变量声明：</h3>
<figure class="highlight rust"><figcaption data-lang="rust"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">struct</span> <span class="token type-definition class-name">Struct</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    e<span class="token punctuation">:</span><span class="token keyword">i32</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token comment">// 若不使用变量时，需要在变量名前面写一个下划线，表示该变量不会被使用，这样才不会报错</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token comment">// let mut _x = 5;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token comment">// _x = 6;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token comment">// println!("The value of x is: &#123;&#125;", _x);</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    </pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token comment">//let (a,mut b):(bool,bool)=(true,false);</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token comment">//println!("a is &#123;:?&#125;,b is &#123;:?&#125;",a,b);</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token comment">//b=true;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token comment">//assert_eq!(a,b);// 用于检查两个值是否相等。如果它们不相等，程序会 panic! 并终止运行</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    </pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token keyword">let</span> <span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">,</span> d<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token comment">//_ 代表匹配一个值，但是我们不关心具体的值是什么，因此没有使用一个变量名而是使用了 _</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token punctuation">[</span>c<span class="token punctuation">,</span> <span class="token punctuation">..</span><span class="token punctuation">,</span> d<span class="token punctuation">,</span> _<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token class-name">Struct</span> <span class="token punctuation">&#123;</span> e<span class="token punctuation">,</span> <span class="token punctuation">..</span> <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token class-name">Struct</span> <span class="token punctuation">&#123;</span> e<span class="token punctuation">:</span> <span class="token number">5</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"a is &#123;&#125;, b is &#123;&#125;, c is &#123;&#125;, d is &#123;&#125;, e is &#123;&#125;"</span><span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">,</span> d<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">,</span> d<span class="token punctuation">,</span> e<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token comment">// 常量：</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token keyword">const</span> <span class="token constant">MAX_POINTS</span><span class="token punctuation">:</span> <span class="token keyword">u32</span> <span class="token operator">=</span> <span class="token number">100_000</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"The value of MAX_POINTS is: &#123;&#125;"</span><span class="token punctuation">,</span> <span class="token constant">MAX_POINTS</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>    <span class="token keyword">let</span> space <span class="token operator">=</span> <span class="token string">"    "</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"空格的数量是&#123;&#125;"</span><span class="token punctuation">,</span> space<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre></pre></td></tr><tr><td data-num="29"></td><td><pre>    <span class="token keyword">let</span> guess<span class="token punctuation">:</span><span class="token keyword">i32</span> <span class="token operator">=</span> <span class="token string">"42"</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token string">"Not a number!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="30"></td><td><pre> <span class="token comment">//or:let guess = "42".parse::&lt;i32>().expect("Not a number!");</span></pre></td></tr><tr><td data-num="31"></td><td><pre>    </pre></td></tr><tr><td data-num="32"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id="数值类型"><a class="anchor" href="#数值类型">#</a> 数值类型：</h3>
<h4 id="整数类型"><a class="anchor" href="#整数类型">#</a> 整数类型：</h4>
<p>rust 内置的整数类型</p>
<p><img data-src="https://zty--666.oss-cn-shanghai.aliyuncs.com/202503282000823.png" alt="image-20250328200043773" /></p>
<p>整形字面量可以用下表的形式书写：</p>
<p><img data-src="https://zty--666.oss-cn-shanghai.aliyuncs.com/202503282000611.png" alt="image-20250328200031377" /></p>
<figure class="highlight rust"><figcaption data-lang="rust"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">let</span> a<span class="token punctuation">:</span><span class="token keyword">u8</span> <span class="token operator">=</span> <span class="token number">255</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">let</span> b<span class="token operator">=</span> a<span class="token punctuation">.</span><span class="token function">wrapping_add</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 相当于加法，给溢出了</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//19</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h4 id="浮点型"><a class="anchor" href="#浮点型">#</a> 浮点型：</h4>
<p>两种：f32 和 f64-- 默认</p>
<p>由于精度的原因，我们的 0.1+0.2 不会完全等于 0.3（类似于 python）<img data-src="https://zty--666.oss-cn-shanghai.aliyuncs.com/202503282007894.png" alt="image-20250328200743786" /></p>
<p><img data-src="https://zty--666.oss-cn-shanghai.aliyuncs.com/202503282008493.png" alt="image-20250328200810396" /></p>
<p>我们在 rust 可以用：</p>
<figure class="highlight rust"><figcaption data-lang="rust"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">(</span><span class="token number">0.1_f64</span> <span class="token operator">+</span> <span class="token number">0.2</span> <span class="token operator">-</span> <span class="token number">0.3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0.00001</span></pre></td></tr></table></figure><p>fn main() {<br />
let abc: (f32, f32, f32) = (0.1, 0.2, 0.3);<br />
let xyz: (f64, f64, f64) = (0.1, 0.2, 0.3);</p>
<figure class="highlight rust"><figcaption data-lang="rust"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"abc (f32)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"   0.1 + 0.2: &#123;:x&#125;"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>abc<span class="token number">.0</span> <span class="token operator">+</span> abc<span class="token number">.1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">to_bits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"         0.3: &#123;:x&#125;"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>abc<span class="token number">.2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">to_bits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"xyz (f64)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"   0.1 + 0.2: &#123;:x&#125;"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>xyz<span class="token number">.0</span> <span class="token operator">+</span> xyz<span class="token number">.1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">to_bits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"         0.3: &#123;:x&#125;"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>xyz<span class="token number">.2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">to_bits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token macro property">assert!</span><span class="token punctuation">(</span>abc<span class="token number">.0</span> <span class="token operator">+</span> abc<span class="token number">.1</span> <span class="token operator">==</span> abc<span class="token number">.2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token macro property">assert!</span><span class="token punctuation">(</span>xyz<span class="token number">.0</span> <span class="token operator">+</span> xyz<span class="token number">.1</span> <span class="token operator">==</span> xyz<span class="token number">.2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>结果：</p>
<pre><code>abc (f32)
   0.1 + 0.2: 3e99999a
         0.3: 3e99999a

xyz (f64)
   0.1 + 0.2: 3fd3333333333334
         0.3: 3fd3333333333333


thread 'main' panicked at main.rs:16:5:
assertion failed: xyz.0 + xyz.1 == xyz.2
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
</code></pre>
<p>对  <code>f32</code>  类型做加法时， <code>0.1 + 0.2</code>  的结果是  <code>3e99999a</code> ， <code>0.3</code>  也是  <code>3e99999a</code> ，因此  <code>f32</code>  下的  <code>0.1 + 0.2 == 0.3</code>  通过测试，但是到了  <code>f64</code>  类型时，结果就不一样了，因为  <code>f64</code>  精度高很多，因此在小数点非常后面发生了一点微小的变化， <code>0.1 + 0.2</code>  以  <code>4</code>  结尾，但是  <code>0.3</code>  以 <code>3</code>  结尾，这个细微区别导致  <code>f64</code>  下的测试失败了，并且抛出了异常。</p>
<h4 id="运算"><a class="anchor" href="#运算">#</a> 运算:</h4>
<p>+-*/ %（求余）</p>
<h4 id="位运算"><a class="anchor" href="#位运算">#</a> 位运算：</h4>
<p><img data-src="https://zty--666.oss-cn-shanghai.aliyuncs.com/202503282012293.png" alt="image-20250328201221251" /></p>
<figure class="highlight rust"><figcaption data-lang="rust"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token comment">// 无符号 8 位整数，二进制为 00000010</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">let</span> a<span class="token punctuation">:</span> <span class="token keyword">u8</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// 也可以写 let a: u8 = 0b_0000_0010;</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token comment">// 二进制为 00000011</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">let</span> b<span class="token punctuation">:</span> <span class="token keyword">u8</span> <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token comment">// &#123;:08b&#125;：左高右低输出二进制 01，不足 8 位则高位补 0</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"a value is        &#123;:08b&#125;"</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"b value is        &#123;:08b&#125;"</span><span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"(a &amp; b) value is  &#123;:08b&#125;"</span><span class="token punctuation">,</span> a <span class="token operator">&amp;</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"(a | b) value is  &#123;:08b&#125;"</span><span class="token punctuation">,</span> a <span class="token operator">|</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"(a ^ b) value is  &#123;:08b&#125;"</span><span class="token punctuation">,</span> a <span class="token operator">^</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"(!b) value is     &#123;:08b&#125;"</span><span class="token punctuation">,</span> <span class="token operator">!</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"(a &lt;&lt; b) value is &#123;:08b&#125;"</span><span class="token punctuation">,</span> a <span class="token operator">&lt;&lt;</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"(a >> b) value is &#123;:08b&#125;"</span><span class="token punctuation">,</span> a <span class="token operator">>></span> b<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre></pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token keyword">let</span> <span class="token keyword">mut</span> a <span class="token operator">=</span> a<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>    <span class="token comment">// 注意这些计算符除了！之外都可以加上 = 进行赋值 (因为！= 要用来判断不等于)</span></pre></td></tr><tr><td data-num="27"></td><td><pre>    a <span class="token operator">&lt;&lt;=</span> b<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"(a &lt;&lt; b) value is &#123;:08b&#125;"</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>位运算要用 u8，结果：</p>
<pre><code>a value is        00000010
b value is        00000011
(a &amp; b) value is  00000010
(a | b) value is  00000011
(a ^ b) value is  00000001
(!b) value is     11111100
(a &lt;&lt; b) value is 00010000
(a &gt;&gt; b) value is 00000000
(a &lt;&lt; b) value is 00010000
</code></pre>
<h4 id="序列"><a class="anchor" href="#序列">#</a> 序列（***）：</h4>
<p>我们可以用 1..5 这个来生成 1-5 这几个连续数值，包括 5</p>
<figure class="highlight rust"><figcaption data-lang="rust"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token number">1</span><span class="token punctuation">..=</span><span class="token number">5</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><pre><code>1
2
3
4
5
</code></pre>
<p>还能用于字符类型，源于他们的连续型（猜测应该是 ascii 的连续性）</p>
<h4 id="as完成类型转换"><a class="anchor" href="#as完成类型转换">#</a> AS 完成类型转换：</h4>
<figure class="highlight rust"><figcaption data-lang="rust"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>   <span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token number">3.1</span> <span class="token keyword">as</span> <span class="token keyword">i8</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>   <span class="token keyword">let</span> b <span class="token operator">=</span> <span class="token number">100_i8</span> <span class="token keyword">as</span> <span class="token keyword">i32</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>   <span class="token keyword">let</span> c <span class="token operator">=</span> <span class="token char">'a'</span> <span class="token keyword">as</span> <span class="token keyword">u8</span><span class="token punctuation">;</span> <span class="token comment">// 将字符 'a' 转换为整数，97</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>   <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;,&#123;&#125;,&#123;&#125;"</span><span class="token punctuation">,</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>有理数和复数：</p>
<figure class="highlight rust"><figcaption data-lang="rust"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">use</span> <span class="token namespace">num<span class="token punctuation">::</span>complex<span class="token punctuation">::</span></span><span class="token class-name">Complex</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre> <span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>   <span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token class-name">Complex</span> <span class="token punctuation">&#123;</span> re<span class="token punctuation">:</span> <span class="token number">2.1</span><span class="token punctuation">,</span> im<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">1.2</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>   <span class="token keyword">let</span> b <span class="token operator">=</span> <span class="token class-name">Complex</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token number">11.1</span><span class="token punctuation">,</span> <span class="token number">22.2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>   <span class="token keyword">let</span> result <span class="token operator">=</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre>   <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125; + &#123;&#125;i"</span><span class="token punctuation">,</span> result<span class="token punctuation">.</span>re<span class="token punctuation">,</span> result<span class="token punctuation">.</span>im<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre> <span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>结果：</p>
<pre><code>13.2 + 21i
</code></pre>
<h4 id="字符布尔单元类型"><a class="anchor" href="#字符布尔单元类型">#</a> 字符，布尔，单元类型：</h4>
<p>单元类型：</p>
<p>单元类型就是  <code>()</code>  ，对，你没看错，就是  <code>()</code>  ，唯一的值也是  <code>()</code>  ，一些读者读到这里可能就不愿意了，你也太敷衍了吧，管这叫类型？</p>
<p>只能说，再不起眼的东西，都有其用途，在目前为止的学习过程中，大家已经看到过很多次  <code>fn main()</code>  函数的使用吧？那么这个函数返回什么呢？</p>
<p>没错，  <code>main</code>  函数就返回这个单元类型  <code>()</code> ，你不能说  <code>main</code>  函数无返回值，因为没有返回值的函数在 Rust 中是有单独的定义的： <code>发散函数( diverge function )</code> ，顾名思义，无法收敛的函数。</p>
<p>例如常见的  <code>println!()</code>  的返回值也是单元类型  <code>()</code> 。</p>
<p>再比如，你可以用  <code>()</code>  作为  <code>map</code>  的值，表示我们不关注具体的值，只关注  <code>key</code> 。 这种用法和 Go 语言的 <em><strong>struct{}</strong></em> 类似，可以作为一个值用来占位，但是完全<strong>不占用</strong>任何内存。</p>
<h4 id="语句与表达式"><a class="anchor" href="#语句与表达式">#</a> 语句与表达式：</h4>
<p>表达式会进行求值，然后返回一个值。例如  <code>5 + 6</code> ，在求值后，返回值  <code>11</code> ，因此它就是一条表达式。</p>
<p>表达式可以成为语句的一部分，例如  <code>let y = 6</code>  中， <code>6</code>  就是一个表达式，它在求值后返回一个值  <code>6</code> （有些反直觉，但是确实是表达式）。</p>
<p>调用一个函数是表达式，因为会返回一个值，调用宏也是表达式，用花括号包裹最终返回一个值的语句块也是表达式，总之，能返回值，它就是表达式:</p>
<figure class="highlight rust"><figcaption data-lang="rust"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">let</span> y <span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token keyword">let</span> x  <span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">;</span>x<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"The value o y is:&#123;&#125;"</span><span class="token punctuation">,</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>语句块：</p>
<pre><code>&#123;
let x  =3;
x+1
&#125;
</code></pre>
<p>这里的 x+1 就是返回的值</p>
<p>若在表达式里面加上；就是代表不会返回值</p>
<figure class="highlight rust"><figcaption data-lang="rust"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span><span class="token function">ret_unit_type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">ret_unit_type</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token comment">//if 语句块也是一个表达式，因此可以用于赋值，也可以直接返回</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token comment">// 类似三元运算符，在 Rust 里我们可以这样写</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">let</span> y <span class="token operator">=</span> <span class="token keyword">if</span> x <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token string">"odd"</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token string">"even"</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token comment">// 或者写成一行</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token keyword">let</span> z <span class="token operator">=</span> <span class="token keyword">if</span> x <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token punctuation">&#123;</span> <span class="token string">"odd"</span> <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span> <span class="token string">"even"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h2 id="函数"><a class="anchor" href="#函数">#</a> 函数：</h2>
<p>例子：</p>
<figure class="highlight rust"><figcaption data-lang="rust"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">add</span><span class="token punctuation">(</span>i<span class="token punctuation">:</span><span class="token keyword">i32</span><span class="token punctuation">,</span>j<span class="token punctuation">:</span><span class="token keyword">i32</span><span class="token punctuation">)</span><span class="token punctuation">-></span><span class="token keyword">i32</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>i<span class="token operator">+</span>j</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><img data-src="https://zty--666.oss-cn-shanghai.aliyuncs.com/202503282040120.png" alt="image-20250328204037066" /></p>
<h3 id="所有权与借用"><a class="anchor" href="#所有权与借用">#</a> 所有权与借用：</h3>
<h4 id="所有权"><a class="anchor" href="#所有权">#</a> 所有权：</h4>
<p>所有的程序都必须和计算机内存打交道，如何从内存中申请空间来存放程序的运行内容，如何在不需要的时候释放这些空间，成了重中之重，也是所有编程语言设计的难点之一。在计算机语言不断演变过程中，出现了三种流派：</p>
<ul>
<li><strong>垃圾回收机制 (GC)</strong>，在程序运行时不断寻找不再使用的内存，典型代表：Java、Go</li>
<li><strong>手动管理内存的分配和释放</strong>，在程序中，通过函数调用的方式来申请和释放内存，典型代表：C++</li>
<li><strong>通过所有权来管理内存</strong>，编译器在编译时会根据一系列规则进行检查</li>
</ul>
<p>其中 Rust 选择了第三种，最妙的是，这种检查只发生在编译期，因此对于程序运行期，不会有任何性能上的损失。</p>
<p>由于所有权是一个新概念，因此读者需要花费一些时间来掌握它，一旦掌握，海阔天空任你飞跃，在本章，我们将通过  <code>字符串</code>  来引导讲解所有权的相关知识。</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">int</span><span class="token operator">*</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">int</span> a<span class="token punctuation">;</span>          <span class="token comment">// 变量 a 的作用域开始</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    a <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">char</span> <span class="token operator">*</span>c <span class="token operator">=</span> <span class="token string">"xyz"</span><span class="token punctuation">;</span>   <span class="token comment">// 变量 c 的作用域开始</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">return</span> <span class="token operator">&amp;</span>a<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span>                   <span class="token comment">// 变量 a 和 c 的作用域结束</span></pre></td></tr></table></figure><p>这段代码虽然可以编译通过，但是其实非常糟糕，变量 a 是在函数内进行的定义分配的内存，现在我返回这个的指针，但是我分配时在这个函数块里面，这样的话过了这个函数 a 就会被自动释放，这个 a 变量的指针会被释放无效，或是被其他的函数调用或局部变量覆盖，从而造成了  <code>悬空指针(Dangling Pointer)</code>  的问题。这是一个非常典型的内存安全问题，虽然编译可以通过，但是运行的时候会出现错误，很多编程语言都存在。</p>
<p>再来看变量  <code>c</code> ， <code>c</code>  的值是常量字符串，存储于常量区，可能这个函数我们只调用了一次，也可能我们不再会使用这个字符串，但  <code>&quot;xyz&quot;</code>  只有当整个程序结束后系统才能回收这片内存。</p>
<p>所以内存安全问题，一直都是程序员非常头疼的问题，好在，在 Rust 中这些问题即将成为历史，因为 Rust 在编译的时候就可以帮助我们发现内存不安全的问题，那 Rust 如何做到这一点呢？</p>
<p>在正式进入主题前，先来一个预热知识。</p>
<h5 id="栈与堆"><a class="anchor" href="#栈与堆">#</a> 栈与堆：</h5>
<p>栈和堆的核心目标就是</p>
<p>为程序在运行时提供可供使用的内存空间。</p>
<h6 id="栈"><a class="anchor" href="#栈">#</a> 栈：</h6>
<p>（栈中的数据必须是占用已知且固定大小的内存空间）先进后出，加数据是进栈，移出数据叫出栈</p>
<h6 id="堆"><a class="anchor" href="#堆">#</a> 堆：</h6>
<p>（堆中的数据都是大小未知或者可能变化的数据）</p>
<p>当向堆上放入数据时，需要请求一定大小的内存空间。操作系统在堆的某处找到一块足够大的空位，把它标记为已使用，并返回一个表示该位置地址的<strong>指针</strong>，该过程被称为<strong>在堆上分配内存</strong>，有时简称为 “分配”(allocating)。</p>
<p>接着该指针会被<strong>推入栈中</strong>中，因为指针的大小是一直且固定的，后续使用过程中可以通过这个指针访问堆来访问这指针对应的数据</p>
<h6 id="性能区别"><a class="anchor" href="#性能区别">#</a> 性能区别：</h6>
<pre><code>在栈上分配内存比在堆上分配内存要快，因为入栈时操作系统无需进行函数调用（或更慢的系统调用）来分配新的空间，只需要将新数据放入栈顶即可。相比之下，在堆上分配内存则需要更多的工作，这是因为操作系统必须首先找到一块足够存放数据的内存空间，接着做一些记录为下一次分配做准备，如果当前进程分配的内存页不足时，还需要进行系统调用来申请更多内存。 因此，处理器在栈上分配数据会比在堆上分配数据更加高效。
</code></pre>
<h6 id="所有权与堆栈"><a class="anchor" href="#所有权与堆栈">#</a> <span class="exturl" data-url="aHR0cHM6Ly9jb3Vyc2UucnMvYmFzaWMvb3duZXJzaGlwL293bmVyc2hpcC5odG1sIyVFNiU4OSU4MCVFNiU5QyU4OSVFNiU5RCU4MyVFNCVCOCU4RSVFNSVBMCU4NiVFNiVBMCU4OA==">所有权与堆栈</span></h6>
<p>当你的代码调用一个函数时，传递给函数的参数（包括可能指向堆上数据的指针和函数的局部变量）依次被压入栈中，当函数调用结束时，这些值将被从栈中按照相反的顺序依次移除。</p>
<p>因为堆上的数据缺乏组织，因此跟踪这些数据何时分配和释放是非常重要的，否则堆上的数据将产生内存泄漏 —— 这些数据将永远无法被回收。这就是 Rust 所有权系统为我们提供的强大保障。</p>
<p>对于其他很多编程语言，你确实无需理解堆栈的原理，但是<strong>在 Rust 中，明白堆栈的原理，对于我们理解所有权的工作原理会有很大的帮助</strong>。</p>
<h5 id="所有权原则"><a class="anchor" href="#所有权原则">#</a> 所有权原则：</h5>
<p>规则：</p>
<pre><code>1.rust中每一个值都被一个变量所拥有，该变量被称为值的所有这
2.一个值同时只能被一个变量所拥有，或者说一个值只能拥有一个所有者
3.当所有者（变量）离开作用域范围时，这个值将被丢弃（drop）
</code></pre>
<p>例如字符串：</p>
<p>之前的语言都是直接给一个字符串值，但是不能改变了，这中叫做是被硬编码进程序里的字符串值（类型为 &amp; str）</p>
<p>又两个缺点：</p>
<p>不能变，不是什么时候都是可以在编写代码时后就可以得知的</p>
<p>所以，rust 提供动态字符串类型：String, 该类型被分配到堆上，因此可以动态伸缩，也就能存储在编译时大小位置的文本</p>
<p>可以用下面的方法基于字符串字面量来创建 String 类型：</p>
<figure class="highlight rust"><figcaption data-lang="rust"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> s <span class="token operator">=</span><span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>:: 是一种调用操作符，这里表示调用 String 类型中的 from 关联函数，由于 String 类型存储在堆上，因此它是动态的，可以修改：</p>
<pre><code>let mut s =String::from(&quot;hello &quot;);
s.push_str(&quot;,world&quot;);
println!(&quot;&#123;&#125;&quot;,s);
</code></pre>
<p>用 push_str 函数就可以加进去了</p>
<h6 id="变量绑定背后的数据交互"><a class="anchor" href="#变量绑定背后的数据交互">#</a> 变量绑定背后的数据交互：</h6>
<pre><code>let s1= String::from(&quot;hello&quot;);
let s2=s1;
</code></pre>
<p>String 类型是一个复杂类型，又存储在栈中的堆指针，字符串长度，字符串容量，其中堆指针是最重要的，容量是堆内存分配空间的大小，长度是目前已经使用的大小。</p>
<p>Rust 这样解决问题：<strong>当  <code>s1</code>  被赋予  <code>s2</code>  后，Rust 认为  <code>s1</code>  不再有效，因此也无需在  <code>s1</code>  离开作用域后  <code>drop</code>  任何东西，这就是把所有权从  <code>s1</code>  转移给了  <code>s2</code> ， <code>s1</code>  在被赋予  <code>s2</code>  后就马上失效了</strong>。</p>
<p>s1 的引用便会无效了</p>
<p>这样就解决了我们之前的问题， <code>s1</code>  不再指向任何数据，只有  <code>s2</code>  是有效的，当  <code>s2</code>  离开作用域，它就会释放内存。 相信此刻，你应该明白了，为什么 Rust 称呼  <code>let a = b</code>  为<strong>变量绑定</strong>了吧？</p>
<h4 id="引用与解引用"><a class="anchor" href="#引用与解引用">#</a> 引用与解引用</h4>
<h6 id="不可变引用"><a class="anchor" href="#不可变引用">#</a> 不可变引用：</h6>
<figure class="highlight rust"><figcaption data-lang="rust"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">let</span> s1 <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">let</span> len <span class="token operator">=</span> <span class="token function">calculate_length</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>s1<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"The length of '&#123;&#125;' is &#123;&#125;."</span><span class="token punctuation">,</span> s1<span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">calculate_length</span><span class="token punctuation">(</span>s<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">usize</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    s<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><pre><code>这个函数fn calculate_length(s: &amp;String) -&gt; usize &#123;
    s.len()
&#125;我没有对这个函数进行任何操作，所以什么也不会发生
</code></pre>
<p>但是有时候我们有需要对引用进来的值进行操作</p>
<p>这时候就要用 mut 来可变一下了</p>
<h6 id="可变引用"><a class="anchor" href="#可变引用">#</a> 可变引用：</h6>
<figure class="highlight rust"><figcaption data-lang="rust"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">let</span> <span class="token keyword">mut</span> s <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token function">change</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">change</span><span class="token punctuation">(</span>some_string<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    some_string<span class="token punctuation">.</span><span class="token function">push_str</span><span class="token punctuation">(</span><span class="token string">", world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h6 id="这两者的区别与联系"><a class="anchor" href="#这两者的区别与联系">#</a> 这两者的区别与联系:</h6>
<pre><code>1.可变引用只能在一个作用域里面有一个
2.可变引用与不可变引用只能有一个
3.只有不可变引用时，可以有多个不可变引用
</code></pre>
<h3 id="悬垂引用dangling-references"><a class="anchor" href="#悬垂引用dangling-references">#</a> <span class="exturl" data-url="aHR0cHM6Ly9jb3Vyc2UucnMvYmFzaWMvb3duZXJzaGlwL2JvcnJvd2luZy5odG1sIyVFNiU4MiVBQyVFNSU5RSU4MiVFNSVCQyU5NSVFNyU5NCVBOGRhbmdsaW5nLXJlZmVyZW5jZXM=">悬垂引用 (Dangling References)</span></h3>
<p>悬垂引用也叫做悬垂指针，意思为指针指向某个值后，这个值被释放掉了，而指针仍然存在，其指向的内存可能不存在任何值或已被其它变量重新使用。在 Rust 中编译器可以确保引用永远也不会变成悬垂状态：当你获取数据的引用后，编译器可以确保数据不会在引用结束前被释放，要想释放数据，必须先停止其引用的使用。</p>
<p>让我们尝试创建一个悬垂引用，Rust 会抛出一个编译时错误：</p>
<figure class="highlight rust"><figcaption data-lang="rust"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">let</span> reference_to_nothing <span class="token operator">=</span> <span class="token function">dangle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">dangle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token operator">&amp;</span><span class="token class-name">String</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token operator">&amp;</span>s</pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>这里是错误：</p>
<figure class="highlight text"><figcaption data-lang="text"></figcaption><table><tr><td data-num="1"></td><td><pre>error[E0106]: missing lifetime specifier</pre></td></tr><tr><td data-num="2"></td><td><pre> --> src/main.rs:5:16</pre></td></tr><tr><td data-num="3"></td><td><pre>  |</pre></td></tr><tr><td data-num="4"></td><td><pre>5 | fn dangle() -> &amp;String &#123;</pre></td></tr><tr><td data-num="5"></td><td><pre>  |                ^ expected named lifetime parameter</pre></td></tr><tr><td data-num="6"></td><td><pre>  |</pre></td></tr><tr><td data-num="7"></td><td><pre>  = help: this function's return type contains a borrowed value, but there is no value for it to be borrowed from</pre></td></tr><tr><td data-num="8"></td><td><pre>help: consider using the `'static` lifetime</pre></td></tr><tr><td data-num="9"></td><td><pre>  |</pre></td></tr><tr><td data-num="10"></td><td><pre>5 | fn dangle() -> &amp;'static String &#123;</pre></td></tr><tr><td data-num="11"></td><td><pre>  |                ~~~~~~~~</pre></td></tr></table></figure><p>错误信息引用了一个我们还未介绍的功能：<span class="exturl" data-url="aHR0cHM6Ly9jb3Vyc2UucnMvYmFzaWMvbGlmZXRpbWUuaHRtbA==">生命周期 (lifetimes)</span>。不过，即使你不理解生命周期，也可以通过错误信息知道这段代码错误的关键信息：</p>
<figure class="highlight text"><figcaption data-lang="text"></figcaption><table><tr><td data-num="1"></td><td><pre>this function's return type contains a borrowed value, but there is no value for it to be borrowed from.</pre></td></tr><tr><td data-num="2"></td><td><pre>该函数返回了一个借用的值，但是已经找不到它所借用值的来源</pre></td></tr></table></figure><p>仔细看看  <code>dangle</code>  代码的每一步到底发生了什么：</p>
<figure class="highlight rust"><figcaption data-lang="rust"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">dangle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token operator">&amp;</span><span class="token class-name">String</span> <span class="token punctuation">&#123;</span> <span class="token comment">//dangle 返回一个字符串的引用</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//s 是一个新字符串</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token operator">&amp;</span>s <span class="token comment">// 返回字符串 s 的引用</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span> <span class="token comment">// 这里 s 离开作用域并被丢弃。其内存被释放。</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token comment">// 危险！</span></pre></td></tr></table></figure><p>因为  <code>s</code>  是在  <code>dangle</code>  函数内创建的，当  <code>dangle</code>  的代码执行完毕后， <code>s</code>  将被释放，但是此时我们又尝试去返回它的引用。这意味着这个引用会指向一个无效的  <code>String</code> ，这可不对！</p>
<p>其中一个很好的解决方法是直接返回  <code>String</code> ：</p>
<figure class="highlight rust"><figcaption data-lang="rust"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">no_dangle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">String</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>    s</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>这样就没有任何错误了，最终  <code>String</code>  的 <strong>所有权被转移给外面的调用者</strong>。</p>
<h6 id="借用规则总结"><a class="anchor" href="#借用规则总结">#</a> <span class="exturl" data-url="aHR0cHM6Ly9jb3Vyc2UucnMvYmFzaWMvb3duZXJzaGlwL2JvcnJvd2luZy5odG1sIyVFNSU4MCU5RiVFNyU5NCVBOCVFOCVBNyU4NCVFNSU4OCU5OSVFNiU4MCVCQiVFNyVCQiU5Mw==">借用规则总结</span></h6>
<ul>
<li>
<pre><code>总的来说，借用规则如下：

- 同一时刻，你只能拥有要么一个可变引用，要么任意多个不可变引用
- 引用必须总是有效的
</code></pre>
</li>
</ul>
<h3 id="复合类型"><a class="anchor" href="#复合类型">#</a> 复合类型：</h3>
<h4 id="字符串与切片"><a class="anchor" href="#字符串与切片">#</a> 字符串与切片：</h4>
<h5 id="字符串"><a class="anchor" href="#字符串">#</a> 字符串：</h5>
<p>&amp;str 是一个不可变引用（字符串字面量）</p>
<p>String 是可以用来可变引用的</p>
<h5 id="切片"><a class="anchor" href="#切片">#</a> 切片：</h5>
<p>对字符串而言，切片就是对 String 类型中某一部分的引用</p>
<figure class="highlight rust"><figcaption data-lang="rust"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">let</span> hello <span class="token operator">=</span> <span class="token operator">&amp;</span>s<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">..</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">let</span> world <span class="token operator">=</span> <span class="token operator">&amp;</span>s<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">..</span><span class="token number">11</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>hello 就是从 0 索引开始，到索引 5 之前截止（0-4，不包括）</p>
<p>world 同理</p>
<p><img data-src="https://zty--666.oss-cn-shanghai.aliyuncs.com/202503301922483.png" alt="image-20250330192216268" /></p>
<p>切片想要包含 String 最后一个字节：</p>
<figure class="highlight rust"><figcaption data-lang="rust"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">let</span> len <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">let</span> slice <span class="token operator">=</span> <span class="token operator">&amp;</span>s<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">..</span>len<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">let</span> slice <span class="token operator">=</span> <span class="token operator">&amp;</span>s<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">..</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>在对字符串使用切片语法时需要格外小心，切片的索引必须落在字符之间的边界位置，也就是 UTF-8 字符的边界，例如中文在 UTF-8 中占用三个字节，下面的代码就会崩溃：</p>
<figure class="highlight rust"><figcaption data-lang="rust"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token string">"中国人"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre> <span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token operator">&amp;</span>s<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">..</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre> <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>什么是字符串：字符组成的连续集合</p>
<p><strong>Rust 中的字符是 Unicode 类型，因此每个字符占据 4 个字节内存空间，但是在字符串中不一样，字符串是 UTF-8 编码，也就是字符串中的字符所占的字节数是变化的 (1 - 4) Rust 在语言级别，只有一种字符串类型：  <code>str</code> ，它通常是以引用类型出现  <code>&amp;str</code> ，也就是上文提到的字符串切片。虽然语言级别只有上述的  <code>str</code>  类型，但是在标准库里，还有多种不同用途的字符串类型，其中使用最广的即是  <code>String</code>  类型</strong></p>
<p><code>str</code>  类型是硬编码进可执行文件，也无法被修改，但是  <code>String</code>  则是一个可增长、可改变且具有所有权的 UTF-8 编码字符串，<strong>当 Rust 用户提到字符串时，往往指的就是  <code>String</code>  类型和  <code>&amp;str</code>  字符串切片类型，这两个类型都是 UTF-8 编码</strong>。</p>
<p>除了  <code>String</code>  类型的字符串，Rust 的标准库还提供了其他类型的字符串，例如  <code>OsString</code> ，  <code>OsStr</code> ，  <code>CsString</code>  和  <code>CsStr</code>  等，注意到这些名字都以  <code>String</code>  或者  <code>Str</code>  结尾了吗？它们分别对应的是具有所有权和被借用的变量。</p>
<h5 id="string与str的转换"><a class="anchor" href="#string与str的转换">#</a> String 与 &amp; str 的转换：</h5>
<p>在之前的代码中，已经见到好几种从  <code>&amp;str</code>  类型生成  <code>String</code>  类型的操作：</p>
<ul>
<li><code>String::from(&quot;hello,world&quot;)</code></li>
<li><code>&quot;hello,world&quot;.to_string()</code></li>
</ul>
<p>那么如何将  <code>String</code>  类型转为  <code>&amp;str</code>  类型呢？答案很简单，取引用即可：</p>
<figure class="highlight rust"><figcaption data-lang="rust"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello,world!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token function">say_hello</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token function">say_hello</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>s<span class="token punctuation">[</span><span class="token punctuation">..</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token function">say_hello</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">as_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">say_hello</span><span class="token punctuation">(</span>s<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>实际上这种灵活用法是因为  <code>deref</code>  隐式强制转换，具体我们会在 <a target="_blank" rel="noopener" href="https://course.rs/advance/smart-pointer/deref.html"> <code>Deref</code>  特征</a>进行详细讲解。</p>
<h4 id="字符串索引"><a class="anchor" href="#字符串索引">#</a> <span class="exturl" data-url="aHR0cHM6Ly9jb3Vyc2UucnMvYmFzaWMvY29tcG91bmQtdHlwZS9zdHJpbmctc2xpY2UuaHRtbCMlRTUlQUQlOTclRTclQUMlQTYlRTQlQjglQjIlRTclQjQlQTIlRTUlQkMlOTU=">字符串索引</span></h4>
<p>在其它语言中，使用索引的方式访问字符串的某个字符或者子串是很正常的行为，但是在 Rust 中就会报错：</p>
<figure class="highlight rust"><figcaption data-lang="rust"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> s1 <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>   <span class="token keyword">let</span> h <span class="token operator">=</span> s1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>该代码会产生如下错误：</p>
<pre><code class="language-console">3 |     let h = s1[0];
  |             ^^^^^ `String` cannot be indexed by `&#123;integer&#125;`
  |
  = help: the trait `Index&lt;&#123;integer&#125;&gt;` is not implemented for `String`
</code></pre>
<h4 id="深入字符串内部"><a class="anchor" href="#深入字符串内部">#</a> <span class="exturl" data-url="aHR0cHM6Ly9jb3Vyc2UucnMvYmFzaWMvY29tcG91bmQtdHlwZS9zdHJpbmctc2xpY2UuaHRtbCMlRTYlQjclQjElRTUlODUlQTUlRTUlQUQlOTclRTclQUMlQTYlRTQlQjglQjIlRTUlODYlODUlRTklODMlQTg=">深入字符串内部</span></h4>
<p>字符串的底层的数据存储格式实际上是 [  <code>u8</code>  ]，一个字节数组。对于  <code>let hello = String::from(&quot;Hola&quot;);</code>  这行代码来说， <code>Hola</code>  的长度是  <code>4</code>  个字节，因为  <code>&quot;Hola&quot;</code>  中的每个字母在 UTF-8 编码中仅占用 1 个字节，但是对于下面的代码呢？</p>
<figure class="highlight rust"><figcaption data-lang="rust"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> hello <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"中国人"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>如果问你该字符串多长，你可能会说  <code>3</code> ，但是实际上是  <code>9</code>  个字节的长度，因为大部分常用汉字在 UTF-8 中的长度是  <code>3</code>  个字节，因此这种情况下对  <code>hello</code>  进行索引，访问  <code>&amp;hello[0]</code>  没有任何意义，因为你取不到  <code>中</code>  这个字符，而是取到了这个字符三个字节中的第一个字节，这是一个非常奇怪而且难以理解的返回值。</p>
<h4 id="字符串的不同表现形式"><a class="anchor" href="#字符串的不同表现形式">#</a> <span class="exturl" data-url="aHR0cHM6Ly9jb3Vyc2UucnMvYmFzaWMvY29tcG91bmQtdHlwZS9zdHJpbmctc2xpY2UuaHRtbCMlRTUlQUQlOTclRTclQUMlQTYlRTQlQjglQjIlRTclOUElODQlRTQlQjglOEQlRTUlOTAlOEMlRTglQTElQTglRTclOEUlQjAlRTUlQkQlQTIlRTUlQkMlOEY=">字符串的不同表现形式</span></h4>
<p>现在看一下用梵文写的字符串  <code>“नमस्ते”</code> , 它底层的字节数组如下形式：</p>
<figure class="highlight rust"><figcaption data-lang="rust"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span><span class="token number">224</span><span class="token punctuation">,</span> <span class="token number">164</span><span class="token punctuation">,</span> <span class="token number">168</span><span class="token punctuation">,</span> <span class="token number">224</span><span class="token punctuation">,</span> <span class="token number">164</span><span class="token punctuation">,</span> <span class="token number">174</span><span class="token punctuation">,</span> <span class="token number">224</span><span class="token punctuation">,</span> <span class="token number">164</span><span class="token punctuation">,</span> <span class="token number">184</span><span class="token punctuation">,</span> <span class="token number">224</span><span class="token punctuation">,</span> <span class="token number">165</span><span class="token punctuation">,</span> <span class="token number">141</span><span class="token punctuation">,</span> <span class="token number">224</span><span class="token punctuation">,</span> <span class="token number">164</span><span class="token punctuation">,</span> <span class="token number">164</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token number">224</span><span class="token punctuation">,</span> <span class="token number">165</span><span class="token punctuation">,</span> <span class="token number">135</span><span class="token punctuation">]</span></pre></td></tr></table></figure><p>长度是 18 个字节，这也是计算机最终存储该字符串的形式。如果从字符的形式去看，则是：</p>
<figure class="highlight rust"><figcaption data-lang="rust"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span><span class="token char">'न'</span><span class="token punctuation">,</span> <span class="token char">'म'</span><span class="token punctuation">,</span> <span class="token char">'स'</span><span class="token punctuation">,</span> <span class="token char">'्'</span><span class="token punctuation">,</span> <span class="token char">'त'</span><span class="token punctuation">,</span> <span class="token char">'े'</span><span class="token punctuation">]</span></pre></td></tr></table></figure><p>但是这种形式下，第四和六两个字母根本就不存在，没有任何意义，接着再从字母串的形式去看：</p>
<figure class="highlight rust"><figcaption data-lang="rust"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span><span class="token string">"न"</span><span class="token punctuation">,</span> <span class="token string">"म"</span><span class="token punctuation">,</span> <span class="token string">"स्"</span><span class="token punctuation">,</span> <span class="token string">"ते"</span><span class="token punctuation">]</span></pre></td></tr></table></figure><p>所以，可以看出来 Rust 提供了不同的字符串展现方式，这样程序可以挑选自己想要的方式去使用，而无需去管字符串从人类语言角度看长什么样。</p>
<p>还有一个原因导致了 Rust 不允许去索引字符串：因为索引操作，我们总是期望它的性能表现是 O (1)，然而对于  <code>String</code>  类型来说，无法保证这一点，因为 Rust 可能需要从 0 开始去遍历字符串来定位合法的字符。</p>
<h4 id="字符串切片"><a class="anchor" href="#字符串切片">#</a> <span class="exturl" data-url="aHR0cHM6Ly9jb3Vyc2UucnMvYmFzaWMvY29tcG91bmQtdHlwZS9zdHJpbmctc2xpY2UuaHRtbCMlRTUlQUQlOTclRTclQUMlQTYlRTQlQjglQjIlRTUlODglODclRTclODklODc=">字符串切片</span></h4>
<p>前文提到过，字符串切片是非常危险的操作，因为切片的索引是通过字节来进行，但是字符串又是 UTF-8 编码，因此你无法保证索引的字节刚好落在字符的边界上，例如：</p>
<figure class="highlight rust"><figcaption data-lang="rust"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> hello <span class="token operator">=</span> <span class="token string">"中国人"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token operator">&amp;</span>hello<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">..</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>运行上面的程序，会直接造成崩溃：</p>
<pre><code class="language-console">thread 'main' panicked at 'byte index 2 is not a char boundary; it is inside '中' (bytes 0..3) of `中国人`', src/main.rs:4:14
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
</code></pre>
<p>这里提示的很清楚，我们索引的字节落在了  <code>中</code>  字符的内部，这种返回没有任何意义。</p>
<p>因此在通过索引区间来访问字符串时，<strong>需要格外的小心</strong>，一不注意，就会导致你程序的崩溃！</p>
<h3 id="字符串操作"><a class="anchor" href="#字符串操作">#</a> 字符串操作（***）：</h3>
<h4 id="追加-push"><a class="anchor" href="#追加-push">#</a> <span class="exturl" data-url="aHR0cHM6Ly9jb3Vyc2UucnMvYmFzaWMvY29tcG91bmQtdHlwZS9zdHJpbmctc2xpY2UuaHRtbCMlRTglQkYlQkQlRTUlOEElQTAtcHVzaA==">追加 (Push)</span></h4>
<p>在字符串尾部可以使用  <code>push()</code>  方法追加字符  <code>char</code> ，也可以使用  <code>push_str()</code>  方法追加字符串字面量。这两个方法都是<strong>在原有的字符串上追加，并不会返回新的字符串</strong>。由于字符串追加操作要修改原来的字符串，则该字符串必须是可变的，即<strong>字符串变量必须由  <code>mut</code>  关键字修饰</strong>。</p>
<p>示例代码如下：</p>
<figure class="highlight rust"><figcaption data-lang="rust"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">let</span> <span class="token keyword">mut</span> s <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"Hello "</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>    s<span class="token punctuation">.</span><span class="token function">push_str</span><span class="token punctuation">(</span><span class="token string">"rust"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"追加字符串 push_str() -> &#123;&#125;"</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>    s<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token char">'!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"追加字符 push() -> &#123;&#125;"</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>代码运行结果：</p>
<pre><code class="language-console">追加字符串 push_str() -&gt; Hello rust
追加字符 push() -&gt; Hello rust!
</code></pre>
<h4 id="插入-insert"><a class="anchor" href="#插入-insert">#</a> <span class="exturl" data-url="aHR0cHM6Ly9jb3Vyc2UucnMvYmFzaWMvY29tcG91bmQtdHlwZS9zdHJpbmctc2xpY2UuaHRtbCMlRTYlOEYlOTIlRTUlODUlQTUtaW5zZXJ0">插入 (Insert)</span></h4>
<p>可以使用  <code>insert()</code>  方法插入单个字符  <code>char</code> ，也可以使用  <code>insert_str()</code>  方法插入字符串字面量，与  <code>push()</code>  方法不同，这俩方法需要传入两个参数，第一个参数是字符（串）插入位置的索引，第二个参数是要插入的字符（串），索引从 0 开始计数，如果越界则会发生错误。由于字符串插入操作要<strong>修改原来的字符串</strong>，则该字符串必须是可变的，即<strong>字符串变量必须由  <code>mut</code>  关键字修饰</strong>。</p>
<p>示例代码如下：</p>
<figure class="highlight rust"><figcaption data-lang="rust"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">let</span> <span class="token keyword">mut</span> s <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"Hello rust!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    s<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token char">','</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"插入字符 insert() -> &#123;&#125;"</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    s<span class="token punctuation">.</span><span class="token function">insert_str</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token string">" I like"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"插入字符串 insert_str() -> &#123;&#125;"</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>代码运行结果：</p>
<pre><code class="language-console">插入字符 insert() -&gt; Hello, rust!
插入字符串 insert_str() -&gt; Hello, I like rust!
</code></pre>
<h4 id="替换-replace"><a class="anchor" href="#替换-replace">#</a> <span class="exturl" data-url="aHR0cHM6Ly9jb3Vyc2UucnMvYmFzaWMvY29tcG91bmQtdHlwZS9zdHJpbmctc2xpY2UuaHRtbCMlRTYlOUIlQkYlRTYlOEQlQTItcmVwbGFjZQ==">替换 (Replace)</span></h4>
<p>如果想要把字符串中的某个字符串替换成其它的字符串，那可以使用  <code>replace()</code>  方法。与替换有关的方法有三个。</p>
<p>1、 <code>replace</code></p>
<p>该方法可适用于  <code>String</code>  和  <code>&amp;str</code>  类型。 <code>replace()</code>  方法接收两个参数，第一个参数是要被替换的字符串，第二个参数是新的字符串。该方法会替换所有匹配到的字符串。<strong>该方法是返回一个新的字符串，而不是操作原来的字符串</strong>。</p>
<p>示例代码如下：</p>
<figure class="highlight rust"><figcaption data-lang="rust"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">let</span> string_replace <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"I like rust. Learning rust is my favorite!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">let</span> new_string_replace <span class="token operator">=</span> string_replace<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">"rust"</span><span class="token punctuation">,</span> <span class="token string">"RUST"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>new_string_replace<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>代码运行结果：</p>
<pre><code class="language-console">new_string_replace = &quot;I like RUST. Learning RUST is my favorite!&quot;
</code></pre>
<p>2、 <code>replacen</code></p>
<p>该方法可适用于  <code>String</code>  和  <code>&amp;str</code>  类型。 <code>replacen()</code>  方法接收三个参数，前两个参数与  <code>replace()</code>  方法一样，第三个参数则表示替换的个数。<strong>该方法是返回一个新的字符串，而不是操作原来的字符串</strong>。</p>
<p>示例代码如下：</p>
<figure class="highlight rust"><figcaption data-lang="rust"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">let</span> string_replace <span class="token operator">=</span> <span class="token string">"I like rust. Learning rust is my favorite!"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">let</span> new_string_replacen <span class="token operator">=</span> string_replace<span class="token punctuation">.</span><span class="token function">replacen</span><span class="token punctuation">(</span><span class="token string">"rust"</span><span class="token punctuation">,</span> <span class="token string">"RUST"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>new_string_replacen<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>代码运行结果：</p>
<pre><code class="language-console">new_string_replacen = &quot;I like RUST. Learning rust is my favorite!&quot;
</code></pre>
<p>3、 <code>replace_range</code></p>
<p>该方法仅适用于  <code>String</code>  类型。 <code>replace_range</code>  接收两个参数，第一个参数是要替换字符串的范围（Range），第二个参数是新的字符串。<strong>该方法是直接操作原来的字符串，不会返回新的字符串。该方法需要使用  <code>mut</code>  关键字修饰</strong>。</p>
<p>示例代码如下：</p>
<figure class="highlight rust"><figcaption data-lang="rust"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">let</span> <span class="token keyword">mut</span> string_replace_range <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"I like rust!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    string_replace_range<span class="token punctuation">.</span><span class="token function">replace_range</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">..</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token string">"R"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>string_replace_range<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>代码运行结果：</p>
<pre><code class="language-console">string_replace_range = &quot;I like Rust!&quot;
</code></pre>
<h4 id="删除-delete"><a class="anchor" href="#删除-delete">#</a> <span class="exturl" data-url="aHR0cHM6Ly9jb3Vyc2UucnMvYmFzaWMvY29tcG91bmQtdHlwZS9zdHJpbmctc2xpY2UuaHRtbCMlRTUlODglQTAlRTklOTklQTQtZGVsZXRl">删除 (Delete)</span></h4>
<p>与字符串删除相关的方法有 4 个，它们分别是  <code>pop()</code> ， <code>remove()</code> ， <code>truncate()</code> ， <code>clear()</code> 。这四个方法仅适用于  <code>String</code>  类型。</p>
<p>1、  <code>pop</code>  —— 删除并返回字符串的最后一个字符</p>
<p><strong>该方法是直接操作原来的字符串</strong>。但是存在返回值，其返回值是一个  <code>Option</code>  类型，如果字符串为空，则返回  <code>None</code> 。</p>
<p>示例代码如下：</p>
<figure class="highlight rust"><figcaption data-lang="rust"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">let</span> <span class="token keyword">mut</span> string_pop <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"rust pop 中文!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">let</span> p1 <span class="token operator">=</span> string_pop<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">let</span> p2 <span class="token operator">=</span> string_pop<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>p1<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>p2<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>string_pop<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>代码运行结果：</p>
<pre><code class="language-console">p1 = Some(
   '!',
)
p2 = Some(
   '文',
)
string_pop = &quot;rust pop 中&quot;
</code></pre>
<p>2、  <code>remove</code>  —— 删除并返回字符串中指定位置的字符</p>
<p><strong>该方法是直接操作原来的字符串</strong>。但是存在返回值，其返回值是删除位置的字符串，只接收一个参数，表示该字符起始索引位置。 <code>remove()</code>  方法是按照字节来处理字符串的，如果参数所给的位置不是合法的字符边界，则会发生错误。</p>
<p>示例代码如下：</p>
<figure class="highlight rust"><figcaption data-lang="rust"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">let</span> <span class="token keyword">mut</span> string_remove <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"测试remove方法"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token macro property">println!</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token string">"string_remove 占 &#123;&#125; 个字节"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token namespace">std<span class="token punctuation">::</span>mem<span class="token punctuation">::</span></span><span class="token function">size_of_val</span><span class="token punctuation">(</span>string_remove<span class="token punctuation">.</span><span class="token function">as_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token comment">// 删除第一个汉字</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    string_remove<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token comment">// 下面代码会发生错误</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token comment">// string_remove.remove(1);</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token comment">// 直接删除第二个汉字</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token comment">// string_remove.remove(3);</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>string_remove<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>代码运行结果：</p>
<pre><code class="language-console">string_remove 占 18 个字节
string_remove = &quot;试remove方法&quot;
</code></pre>
<p>3、 <code>truncate</code>  —— 删除字符串中从指定位置开始到结尾的全部字符</p>
<p><strong>该方法是直接操作原来的字符串</strong>。无返回值。该方法  <code>truncate()</code>  方法是按照字节来处理字符串的，如果参数所给的位置不是合法的字符边界，则会发生错误。</p>
<p>示例代码如下：</p>
<figure class="highlight rust"><figcaption data-lang="rust"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">let</span> <span class="token keyword">mut</span> string_truncate <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"测试truncate"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    string_truncate<span class="token punctuation">.</span><span class="token function">truncate</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>string_truncate<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>代码运行结果：</p>
<pre><code class="language-console">string_truncate = &quot;测&quot;
</code></pre>
<p>4、 <code>clear</code>  —— 清空字符串</p>
<p><strong>该方法是直接操作原来的字符串</strong>。调用后，删除字符串中的所有字符，相当于  <code>truncate()</code>  方法参数为 0 的时候。</p>
<p>示例代码如下：</p>
<figure class="highlight rust"><figcaption data-lang="rust"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">let</span> <span class="token keyword">mut</span> string_clear <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"string clear"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    string_clear<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>string_clear<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>代码运行结果：</p>
<pre><code class="language-console">string_clear = &quot;&quot;
</code></pre>
<h4 id="连接-concatenate"><a class="anchor" href="#连接-concatenate">#</a> <span class="exturl" data-url="aHR0cHM6Ly9jb3Vyc2UucnMvYmFzaWMvY29tcG91bmQtdHlwZS9zdHJpbmctc2xpY2UuaHRtbCMlRTglQkYlOUUlRTYlOEUlQTUtY29uY2F0ZW5hdGU=">连接 (Concatenate)</span></h4>
<p>1、使用  <code>+</code>  或者  <code>+=</code>  连接字符串</p>
<p>使用  <code>+</code>  或者  <code>+=</code>  连接字符串，要求右边的参数必须为字符串的切片引用（Slice）类型。其实当调用  <code>+</code>  的操作符时，相当于调用了  <code>std::string</code>  标准库中的 <a target="_blank" rel="noopener" href="https://doc.rust-lang.org/std/string/struct.String.html#method.add"> <code>add()</code> </a> 方法，这里  <code>add()</code>  方法的第二个参数是一个引用的类型。因此我们在使用  <code>+</code>  时， 必须传递切片引用类型。不能直接传递  <code>String</code>  类型。<strong> <code>+</code>  是返回一个新的字符串，所以变量声明可以不需要  <code>mut</code>  关键字修饰</strong>。</p>
<p>示例代码如下：</p>
<figure class="highlight rust"><figcaption data-lang="rust"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">let</span> string_append <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello "</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">let</span> string_rust <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"rust"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token comment">// &amp;string_rust 会自动解引用为 & amp;str</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">let</span> result <span class="token operator">=</span> string_append <span class="token operator">+</span> <span class="token operator">&amp;</span>string_rust<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">let</span> <span class="token keyword">mut</span> result <span class="token operator">=</span> result <span class="token operator">+</span> <span class="token string">"!"</span><span class="token punctuation">;</span> <span class="token comment">// `result +"!"`中的`result` 是不可变的</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    result <span class="token operator">+=</span> <span class="token string">"!!!"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"连接字符串 + -> &#123;&#125;"</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>代码运行结果：</p>
<pre><code class="language-console">连接字符串 + -&gt; hello rust!!!!
</code></pre>
<p><code>add()</code>  方法的定义：</p>
<figure class="highlight rust"><figcaption data-lang="rust"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">add</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">,</span> s<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">String</span></pre></td></tr></table></figure><p>因为该方法涉及到更复杂的特征功能，因此我们这里简单说明下：</p>
<figure class="highlight rust"><figcaption data-lang="rust"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">let</span> s1 <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello,"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">let</span> s2 <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"world!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token comment">// 在下句中，s1 的所有权被转移走了，因此后面不能再使用 s1</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">let</span> s3 <span class="token operator">=</span> s1 <span class="token operator">+</span> <span class="token operator">&amp;</span>s2<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>s3<span class="token punctuation">,</span><span class="token string">"hello,world!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token comment">// 下面的语句如果去掉注释，就会报错</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token comment">// println!("&#123;&#125;",s1);</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><code>self</code>  是  <code>String</code>  类型的字符串  <code>s1</code> ，该函数说明，只能将  <code>&amp;str</code>  类型的字符串切片添加到  <code>String</code>  类型的  <code>s1</code>  上，然后返回一个新的  <code>String</code>  类型，所以  <code>let s3 = s1 + &amp;s2;</code>  就很好解释了，将  <code>String</code>  类型的  <code>s1</code>  与  <code>&amp;str</code>  类型的  <code>s2</code>  进行相加，最终得到  <code>String</code>  类型的  <code>s3</code> 。</p>
<p>由此可推，以下代码也是合法的：</p>
<figure class="highlight rust"><figcaption data-lang="rust"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> s1 <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"tic"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">let</span> s2 <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"tac"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">let</span> s3 <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"toe"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment">// String = String + &amp;str + &amp;str + &amp;str + &amp;str</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">let</span> s <span class="token operator">=</span> s1 <span class="token operator">+</span> <span class="token string">"-"</span> <span class="token operator">+</span> <span class="token operator">&amp;</span>s2 <span class="token operator">+</span> <span class="token string">"-"</span> <span class="token operator">+</span> <span class="token operator">&amp;</span>s3<span class="token punctuation">;</span></pre></td></tr></table></figure><p><code>String + &amp;str</code>  返回一个  <code>String</code> ，然后再继续跟一个  <code>&amp;str</code>  进行  <code>+</code>  操作，返回一个  <code>String</code>  类型，不断循环，最终生成一个  <code>s</code> ，也是  <code>String</code>  类型。</p>
<p><code>s1</code>  这个变量通过调用  <code>add()</code>  方法后，所有权被转移到  <code>add()</code>  方法里面，  <code>add()</code>  方法调用后就被释放了，同时  <code>s1</code>  也被释放了。再使用  <code>s1</code>  就会发生错误。这里涉及到<span class="exturl" data-url="aHR0cHM6Ly9jb3Vyc2UucnMvYmFzaWMvb3duZXJzaGlwL293bmVyc2hpcC5odG1sIyVFOCVCRCVBQyVFNyVBNyVCQiVFNiU4OSU4MCVFNiU5QyU4OSVFNiU5RCU4Mw==">所有权转移（Move）</span>的相关知识。</p>
<p>2、使用  <code>format!</code>  连接字符串</p>
<p><code>format!</code>  这种方式适用于  <code>String</code>  和  <code>&amp;str</code>  。 <code>format!</code>  的用法与  <code>print!</code>  的用法类似，详见<span class="exturl" data-url="aHR0cHM6Ly9jb3Vyc2UucnMvYmFzaWMvZm9ybWF0dGVkLW91dHB1dC5odG1sI3ByaW50cHJpbnRsbmZvcm1hdA==">格式化输出</span>。</p>
<p>示例代码如下：</p>
<figure class="highlight rust"><figcaption data-lang="rust"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">let</span> s1 <span class="token operator">=</span> <span class="token string">"hello"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">let</span> s2 <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"rust"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token macro property">format!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125; &#123;&#125;!"</span><span class="token punctuation">,</span> s1<span class="token punctuation">,</span> s2<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>代码运行结果：</p>
<pre><code class="language-console">hello rust!
</code></pre>
<h3 id="字符串转义"><a class="anchor" href="#字符串转义">#</a> 字符串转义：</h3>
<p>我们可以通过转义的方式  <code>\</code>  输出 ASCII 和 Unicode 字符。</p>
<figure class="highlight rust"><figcaption data-lang="rust"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token comment">// 通过 \ + 字符的十六进制表示，转义输出一个字符</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">let</span> byte_escape <span class="token operator">=</span> <span class="token string">"I'm writing \x52\x75\x73\x74!"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"What are you doing\x3F (\\x3F means ?) &#123;&#125;"</span><span class="token punctuation">,</span> byte_escape<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token comment">// \u 可以输出一个 unicode 字符</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">let</span> unicode_codepoint <span class="token operator">=</span> <span class="token string">"\u&#123;211D&#125;"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">let</span> character_name <span class="token operator">=</span> <span class="token string">"\"DOUBLE-STRUCK CAPITAL R\""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token macro property">println!</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token string">"Unicode character &#123;&#125; (U+211D) is called &#123;&#125;"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        unicode_codepoint<span class="token punctuation">,</span> character_name</pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token comment">// 换行了也会保持之前的字符串格式</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token comment">// 使用 \ 忽略换行符</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token keyword">let</span> long_string <span class="token operator">=</span> <span class="token string">"String literals</pre></td></tr><tr><td data-num="18"></td><td><pre>                        can span multiple lines.</pre></td></tr><tr><td data-num="19"></td><td><pre>                        The linebreak and indentation here ->\</pre></td></tr><tr><td data-num="20"></td><td><pre>                        &lt;- can be escaped too!"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> long_string<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>在 \ 加上一个 \ 转义这个就好了</p>
<figure class="highlight rust"><figcaption data-lang="rust"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> <span class="token string">"hello \\x52\\x75\\x73\\x74"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">let</span> raw_str <span class="token operator">=</span> <span class="token string">r"Escapes don't work here: \x3F \u&#123;211D&#125;"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> raw_str<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token comment">// 如果字符串包含双引号，可以在开头和结尾加 #</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">let</span> quotes <span class="token operator">=</span> <span class="token string">r#"And then I said: "There is no escape!""#</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> quotes<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token comment">// 如果字符串中包含 # 号，可以在开头和结尾加多个 # 号，最多加 255 个，只需保证与字符串中连续 # 号的个数不超过开头和结尾的 # 号的个数即可</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token keyword">let</span> longer_delimiter <span class="token operator">=</span> <span class="token string">r###"A string with "# in it. And even "##!"###</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> longer_delimiter<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>操作 UTF-8 字符串</p>
<p>前文提到了几种使用 UTF-8 字符串的方式，下面来一一说明。</p>
<h4 id="字符"><a class="anchor" href="#字符">#</a> <span class="exturl" data-url="aHR0cHM6Ly9jb3Vyc2UucnMvYmFzaWMvY29tcG91bmQtdHlwZS9zdHJpbmctc2xpY2UuaHRtbCMlRTUlQUQlOTclRTclQUMlQTY=">字符</span></h4>
<p>如果你想要以 Unicode 字符的方式遍历字符串，最好的办法是使用  <code>chars</code>  方法，例如：</p>
<figure class="highlight rust"><figcaption data-lang="rust"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">for</span> c <span class="token keyword">in</span> <span class="token string">"中国人"</span><span class="token punctuation">.</span><span class="token function">chars</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>输出如下</p>
<pre><code class="language-console">中
国
人
</code></pre>
<h4 id="字节"><a class="anchor" href="#字节">#</a> <span class="exturl" data-url="aHR0cHM6Ly9jb3Vyc2UucnMvYmFzaWMvY29tcG91bmQtdHlwZS9zdHJpbmctc2xpY2UuaHRtbCMlRTUlQUQlOTclRTglOEElODI=">字节</span></h4>
<p>这种方式是返回字符串的底层字节数组表现形式：</p>
<figure class="highlight rust"><figcaption data-lang="rust"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">for</span> b <span class="token keyword">in</span> <span class="token string">"中国人"</span><span class="token punctuation">.</span><span class="token function">bytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>输出如下：</p>
<pre><code class="language-console">228
184
173
229
155
189
228
186
186
</code></pre>
<h4 id="获取子串"><a class="anchor" href="#获取子串">#</a> <span class="exturl" data-url="aHR0cHM6Ly9jb3Vyc2UucnMvYmFzaWMvY29tcG91bmQtdHlwZS9zdHJpbmctc2xpY2UuaHRtbCMlRTglOEUlQjclRTUlOEYlOTYlRTUlQUQlOTAlRTQlQjglQjI=">获取子串</span></h4>
<p>想要准确的从 UTF-8 字符串中获取子串是较为复杂的事情，例如想要从  <code>holla中国人नमस्ते</code>  这种变长的字符串中取出某一个子串，使用标准库你是做不到的。 你需要在  <code>crates.io</code>  上搜索  <code>utf8</code>  来寻找想要的功能。</p>
<p>可以考虑尝试下这个库：<span class="exturl" data-url="aHR0cHM6Ly9jcmF0ZXMuaW8vY3JhdGVzL3V0Zjhfc2xpY2U=">utf8_slice</span>。</p>
<h3 id="字符串深度剖析"><a class="anchor" href="#字符串深度剖析">#</a> <span class="exturl" data-url="aHR0cHM6Ly9jb3Vyc2UucnMvYmFzaWMvY29tcG91bmQtdHlwZS9zdHJpbmctc2xpY2UuaHRtbCMlRTUlQUQlOTclRTclQUMlQTYlRTQlQjglQjIlRTYlQjclQjElRTUlQkElQTYlRTUlODklOTYlRTYlOUUlOTA=">字符串深度剖析</span></h3>
<p>那么问题来了，为啥  <code>String</code>  可变，而字符串字面值  <code>str</code>  却不可以？</p>
<p>就字符串字面值来说，我们在编译时就知道其内容，最终字面值文本被直接硬编码进可执行文件中，这使得字符串字面值快速且高效，这主要得益于字符串字面值的不可变性。不幸的是，我们不能为了获得这种性能，而把每一个在编译时大小未知的文本都放进内存中（你也做不到！），因为有的字符串是在程序运行的过程中动态生成的。</p>
<p>对于  <code>String</code>  类型，为了支持一个可变、可增长的文本片段，需要在堆上分配一块在编译时未知大小的内存来存放内容，这些都是在程序运行时完成的：</p>
<ul>
<li>首先向操作系统请求内存来存放  <code>String</code>  对象</li>
<li>在使用完成后，将内存释放，归还给操作系统</li>
</ul>
<p>其中第一部分由  <code>String::from</code>  完成，它创建了一个全新的  <code>String</code> 。</p>
<p>重点来了，到了第二部分，就是百家齐放的环节，在有<strong>垃圾回收 GC</strong> 的语言中，GC 来负责标记并清除这些不再使用的内存对象，这个过程都是自动完成，无需开发者关心，非常简单好用；但是在无 GC 的语言中，需要开发者手动去释放这些内存对象，就像创建对象需要通过编写代码来完成一样，未能正确释放对象造成的后果简直不可估量。</p>
<p>对于 Rust 而言，安全和性能是写到骨子里的核心特性，如果使用 GC，那么会牺牲性能；如果使用手动管理内存，那么会牺牲安全，这该怎么办？为此，Rust 的开发者想出了一个无比惊艳的办法：变量在离开作用域后，就自动释放其占用的内存：</p>
<figure class="highlight rust"><figcaption data-lang="rust"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 从此处起，s 是有效的</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token comment">// 使用 s</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span>                                  <span class="token comment">// 此作用域已结束，</span></pre></td></tr><tr><td data-num="6"></td><td><pre>                                   <span class="token comment">//s 不再有效，内存被释放</span></pre></td></tr></table></figure><p>与其它系统编程语言的  <code>free</code>  函数相同，Rust 也提供了一个释放内存的函数：  <code>drop</code> ，但是不同的是，其它语言要手动调用  <code>free</code>  来释放每一个变量占用的内存，而 Rust 则在变量离开作用域时，自动调用  <code>drop</code>  函数：上面代码中，Rust 在结尾的  <code>&#125;</code>  处自动调用  <code>drop</code> 。</p>
<blockquote>
<p>其实，在 C++ 中，也有这种概念：<em>Resource Acquisition Is Initialization (RAII)</em>。如果你使用过 RAII 模式的话应该对 Rust 的  <code>drop</code>  函数并不陌生。</p>
</blockquote>
<p>这个模式对编写 Rust 代码的方式有着深远的影响，在后面章节我们会进行更深入的介绍。</p>
<h2 id="元组"><a class="anchor" href="#元组">#</a> 元组：</h2>
<p>复合类型：</p>
<h4 id="语法"><a class="anchor" href="#语法">#</a> 语法</h4>
<p>可以通过一下用法创建元组：</p>
<figure class="highlight rust"><figcaption data-lang="rust"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">let</span> tup<span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token keyword">i32</span><span class="token punctuation">,</span><span class="token keyword">f64</span><span class="token punctuation">,</span><span class="token keyword">u8</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">,</span><span class="token number">6.4</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h4 id="模式匹配"><a class="anchor" href="#模式匹配">#</a> 模式匹配：</h4>
<figure class="highlight rust"><figcaption data-lang="rust"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">let</span> tup<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">600</span><span class="token punctuation">,</span><span class="token number">5.4</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">let</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">,</span>z<span class="token punctuation">)</span><span class="token operator">=</span>tup<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"the value of y is &#123;&#125;"</span><span class="token punctuation">,</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>上述代码首先创建一个元组，然后将其绑定到  <code>tup</code>  上，接着使用  <code>let (x, y, z) = tup;</code>  来完成一次模式匹配，因为元组是  <code>(n1, n2, n3)</code>  形式的，因此我们用一模一样的  <code>(x, y, z)</code>  形式来进行匹配，元组中对应的值会绑定到变量  <code>x</code> ，  <code>y</code> ，  <code>z</code>  上。这就是解构：用同样的形式把一个复杂对象中的值匹配出来。</p>
<h4 id="用访问元组"><a class="anchor" href="#用访问元组">#</a> 用。访问元组</h4>
<figure class="highlight rust"><figcaption data-lang="rust"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">let</span> x<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token keyword">i32</span><span class="token punctuation">,</span> <span class="token keyword">f64</span><span class="token punctuation">,</span> <span class="token keyword">u8</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">,</span> <span class="token number">6.4</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">let</span> five_hundred <span class="token operator">=</span> x<span class="token number">.0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">let</span> six_point_four <span class="token operator">=</span> x<span class="token number">.1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">let</span> one <span class="token operator">=</span> x<span class="token number">.2</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>索引从 0 开始</p>
<p>使用实例：</p>
<figure class="highlight rust"><figcaption data-lang="rust"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">let</span> s1 <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">let</span> <span class="token punctuation">(</span>s2<span class="token punctuation">,</span> len<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">calculate_length</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"The length of '&#123;&#125;' is &#123;&#125;."</span><span class="token punctuation">,</span> s2<span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">calculate_length</span><span class="token punctuation">(</span>s<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token keyword">usize</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">let</span> length <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//len () 返回字符串的长度</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token punctuation">(</span>s<span class="token punctuation">,</span> length<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h2 id="结构体"><a class="anchor" href="#结构体">#</a> 结构体</h2>
<h4 id="语法-2"><a class="anchor" href="#语法-2">#</a> 语法:</h4>
<p>中间的不是用；分隔，而是用，分割</p>
<figure class="highlight rust"><figcaption data-lang="rust"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">struct</span> <span class="token type-definition class-name">User</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    active<span class="token punctuation">:</span> <span class="token keyword">bool</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    username<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    email<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    sign_in_count<span class="token punctuation">:</span> <span class="token keyword">u64</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>创建实例：</p>
<figure class="highlight rust"><figcaption data-lang="rust"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> user1 <span class="token operator">=</span> <span class="token class-name">User</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>        email<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"someone@example.com"</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        username<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"someusername123"</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        active<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        sign_in_count<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>有几点值得注意:</p>
<ol>
<li>初始化实例时，<strong>每个字段</strong>都需要进行初始化</li>
<li>初始化时的字段顺序<strong>不需要</strong>和结构体定义时的顺序一致</li>
</ol>
<h4 id="用访问结构体字段"><a class="anchor" href="#用访问结构体字段">#</a> 用。访问结构体字段：</h4>
<figure class="highlight rust"><figcaption data-lang="rust"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> <span class="token keyword">mut</span> user1 <span class="token operator">=</span> <span class="token class-name">User</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>        email<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"someone@example.com"</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        username<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"someusername123"</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        active<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        sign_in_count<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre>    user1<span class="token punctuation">.</span>email <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"anotheremail@example.com"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h4 id="简化结构体创建"><a class="anchor" href="#简化结构体创建">#</a> 简化结构体创建：</h4>
<figure class="highlight rust"><figcaption data-lang="rust"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">build_user</span><span class="token punctuation">(</span>email<span class="token punctuation">:</span><span class="token class-name">String</span> <span class="token punctuation">,</span>username<span class="token punctuation">:</span><span class="token class-name">String</span><span class="token punctuation">)</span><span class="token punctuation">-></span><span class="token class-name">User</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token class-name">User</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>email<span class="token punctuation">:</span>email<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>username<span class="token punctuation">:</span>username<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>active<span class="token punctuation">:</span><span class="token boolean">true</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>sign_in_count<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>它接收两个字符串参数：  <code>email</code>  和  <code>username</code> ，然后使用它们来创建一个  <code>User</code>  结构体，并且返回。可以注意到这两行：  <code>email: email</code>  和  <code>username: username</code> ，非常的扎眼，因为实在有些啰嗦，如果你从 TypeScript 过来，肯定会鄙视 Rust 一番，不过好在，它也不是无可救药：</p>
<figure class="highlight rust"><figcaption data-lang="rust"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">build_user</span><span class="token punctuation">(</span>email<span class="token punctuation">:</span><span class="token class-name">String</span><span class="token punctuation">,</span>username<span class="token punctuation">:</span><span class="token class-name">String</span><span class="token punctuation">)</span><span class="token punctuation">-></span><span class="token class-name">User</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token class-name">User</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>email<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>username<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>active<span class="token punctuation">:</span><span class="token boolean">true</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>sign_in_count<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h4 id="结构体更新语法"><a class="anchor" href="#结构体更新语法">#</a> 结构体更新语法：</h4>
<p>用已有的 user1 来构建 user2：</p>
<figure class="highlight rust"><figcaption data-lang="rust"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> user2<span class="token operator">=</span><span class="token class-name">User</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>active<span class="token punctuation">:</span>user1<span class="token punctuation">.</span>active<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>username<span class="token punctuation">:</span>user1<span class="token punctuation">.</span>username<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>email<span class="token punctuation">:</span><span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"dwqdqd@example.com"</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>sign_in_count<span class="token punctuation">:</span>user1<span class="token punctuation">.</span>sign_in_count<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>rust 给的更新语法：</p>
<figure class="highlight rust"><figcaption data-lang="rust"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> user2<span class="token operator">=</span><span class="token class-name">User</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>email<span class="token punctuation">:</span><span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"dwqdqd@example.com"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">..</span>user1</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>因为  <code>user2</code>  仅仅在  <code>email</code>  上与  <code>user1</code>  不同，因此我们只需要对  <code>email</code>  进行赋值，剩下的通过结构体更新语法  <code>..user1</code>  即可完成。</p>
<p><code>..</code>  语法表明凡是我们没有显式声明的字段，全部从  <code>user1</code>  中自动获取。</p>
<h6 id="需要注意的是-user1-必须在结构体的尾部使用"><a class="anchor" href="#需要注意的是-user1-必须在结构体的尾部使用">#</a> 需要注意的是  <code>..user1</code>  必须在结构体的尾部使用。</h6>
<pre><code>结构体更新语法跟赋值语句 `=` 非常相像，因此在上面代码中，`user1` 的部分字段所有权被转移到 `user2` 中：`username` 字段发生了所有权转移，作为结果，`user1` 无法再被使用。

聪明的读者肯定要发问了：明明有三个字段进行了自动赋值，为何只有 `username` 发生了所有权转移？

仔细回想一下[所有权](https://course.rs/basic/ownership/ownership.html#拷贝浅拷贝)那一节的内容，我们提到了 `Copy` 特征：实现了 `Copy` 特征的类型无需所有权转移，可以直接在赋值时进行 数据拷贝，其中 `bool` 和 `u64` 类型就实现了 `Copy` 特征，因此 `active` 和 `sign_in_count` 字段在赋值给 `user2` 时，仅仅发生了拷贝，而不是所有权转移。

值得注意的是：`username` 所有权被转移给了 `user2`，导致了 `user1` 无法再被使用，但是并不代表 `user1` 内部的其它字段不能被继续使用，例如：
</code></pre>
<figure class="highlight rust"><figcaption data-lang="rust"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> user1 <span class="token operator">=</span> <span class="token class-name">User</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    email<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"someone@example.com"</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    username<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"someusername123"</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    active<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    sign_in_count<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">let</span> user2 <span class="token operator">=</span> <span class="token class-name">User</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    active<span class="token punctuation">:</span> user1<span class="token punctuation">.</span>active<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    username<span class="token punctuation">:</span> user1<span class="token punctuation">.</span>username<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    email<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"another@example.com"</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    sign_in_count<span class="token punctuation">:</span> user1<span class="token punctuation">.</span>sign_in_count<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> user1<span class="token punctuation">.</span>active<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token comment">// 下面这行会报错</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;:?&#125;"</span><span class="token punctuation">,</span> user1<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h4 id="结构体的内存排列"><a class="anchor" href="#结构体的内存排列">#</a> 结构体的内存排列：</h4>
<figure class="highlight rust"><figcaption data-lang="rust"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token attribute attr-name">#[derive(Debug)]</span></pre></td></tr><tr><td data-num="2"></td><td><pre> <span class="token keyword">struct</span> <span class="token type-definition class-name">File</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>   name<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>   data<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token keyword">u8</span><span class="token operator">></span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre> <span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>   <span class="token keyword">let</span> f1 <span class="token operator">=</span> <span class="token class-name">File</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>     name<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"f1.txt"</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="10"></td><td><pre>     data<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="11"></td><td><pre>   <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre>   <span class="token keyword">let</span> f1_name <span class="token operator">=</span> <span class="token operator">&amp;</span>f1<span class="token punctuation">.</span>name<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>   <span class="token keyword">let</span> f1_length <span class="token operator">=</span> <span class="token operator">&amp;</span>f1<span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre>   <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;:?&#125;"</span><span class="token punctuation">,</span> f1<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>   <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125; is &#123;&#125; bytes long"</span><span class="token punctuation">,</span> f1_name<span class="token punctuation">,</span> f1_length<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre> <span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>file 结构体在内存中的排列如下图表示：</p>
<p><img data-src="https://zty--666.oss-cn-shanghai.aliyuncs.com/202503302009501.png" alt="image-20250330200913250" /></p>
<p>这个图清晰的看出 File 结构体两个字符 name 和 data 分别拥有两个 [u8] 数组的所有权（Stringl 欸行的底层也是 [u8] 数组），通过 ptr 指针指向底层数组的内存地址，这里你可以把 ptr 指针理解为 Rust 中的引用类型</p>
<p><strong>把结构体中具有所有权的字段转移出去后，将无法再访问该字段，但是可以正常访问其它的字段。</strong></p>
<h3 id="元组结构体"><a class="anchor" href="#元组结构体">#</a> 元组结构体：</h3>
<p>结构体必须有名称，但是结构体的字段可以没有这个名称，这种结构体很想元组，所以称为元组结构体，例如：</p>
<figure class="highlight rust"><figcaption data-lang="rust"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">struct</span> <span class="token type-definition class-name">Color</span><span class="token punctuation">(</span><span class="token keyword">i32</span><span class="token punctuation">,</span><span class="token keyword">i32</span><span class="token punctuation">,</span><span class="token keyword">i32</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">struct</span> <span class="token type-definition class-name">Point</span><span class="token punctuation">(</span><span class="token keyword">i32</span><span class="token punctuation">,</span><span class="token keyword">i32</span><span class="token punctuation">,</span><span class="token keyword">i32</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">let</span> black<span class="token operator">=</span><span class="token class-name">Color</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">let</span> origin<span class="token operator">=</span><span class="token class-name">Point</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>元组结构体在你希望有一个整体名称，但是又不关心里面字段的名称时将非常有用。例如上面的  <code>Point</code>  元组结构体，众所周知 3D 点是  <code>(x, y, z)</code>  形式的坐标点，因此我们无需再为内部的字段逐一命名为： <code>x</code> ,  <code>y</code> ,  <code>z</code> 。</p>
<h3 id="单元结构体"><a class="anchor" href="#单元结构体">#</a> 单元结构体：</h3>
<p>还记得之前讲过的基本没啥用的<span class="exturl" data-url="aHR0cHM6Ly9jb3Vyc2UucnMvYmFzaWMvYmFzZS10eXBlL2NoYXItYm9vbC5odG1sIyVFNSU4RCU5NSVFNSU4NSU4MyVFNyVCMSVCQiVFNSU5RSU4Qg==">单元类型</span>吧？单元结构体就跟它很像，没有任何字段和属性，但是好在，它还挺有用。</p>
<p>如果你定义一个类型，但是不关心该类型的内容，只关心它的行为时，就可以使用  <code>单元结构体</code> ：</p>
<figure class="highlight rust"><figcaption data-lang="rust"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">struct</span> <span class="token type-definition class-name">AlwaysEqual</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">let</span> subject <span class="token operator">=</span> <span class="token class-name">AlwaysEqual</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment">// 我们不关心 AlwaysEqual 的字段数据，只关心它的行为，因此将它声明为单元结构体，然后再为它实现某个特征</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">impl</span> <span class="token class-name">SomeTrait</span> <span class="token keyword">for</span> <span class="token class-name">AlwaysEqual</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>使用 #[derive (Debug)] 来打印结构体的信息</p>
<p>结构体没有实现 Display 特征，主要原因是由于结构体的复杂性（结构名，子成员的名字，值，所有权归属不知道要输出哪一些），所以用 {} 行不通</p>
<p>我们可以用 {：？} 来进行打印，但是会报错，</p>
<pre><code>error[E0277]: `Rectangle` doesn't implement `Debug`
= help: the trait `Debug` is not implemented for `Rectangle`
= note: add `#[derive(Debug)]` to `Rectangle` or manually `impl Debug for Rectangle`


</code></pre>
<p>显示需要添加 #[derive (Debug)] 这条语句</p>
<p>因为，rust 不会为我们实现 Debug，为了实现，我们有两条方式进行选择：</p>
<pre><code>手动实现

使用derive派生实现
</code></pre>
<p>后者简单得多，但是也有限制。如下使用就行：</p>
<figure class="highlight rust"><figcaption data-lang="rust"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token attribute attr-name">#[derive(Debug)]</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">struct</span> <span class="token type-definition class-name">Rectangle</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    width<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    height<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">let</span> rect1 <span class="token operator">=</span> <span class="token class-name">Rectangle</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        width<span class="token punctuation">:</span> <span class="token number">30</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        height<span class="token punctuation">:</span> <span class="token number">50</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"rect1 is &#123;:?&#125;"</span><span class="token punctuation">,</span> rect1<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>输出：</p>
<pre><code>$ cargo run
rect1 is Rectangle &#123; width: 30, height: 50 &#125;
</code></pre>
<p>我们还可以用 dbg! 来打印</p>
<pre><code>dbg! 输出到标准错误输出 stderr，而 println! 输出到标准输出 stdout。
</code></pre>
<figure class="highlight rust"><figcaption data-lang="rust"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token attribute attr-name">#[derive(Debug)]</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">struct</span> <span class="token type-definition class-name">Rectangle</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    width<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    height<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">let</span> scale <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">let</span> rect1 <span class="token operator">=</span> <span class="token class-name">Rectangle</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        width<span class="token punctuation">:</span> <span class="token macro property">dbg!</span><span class="token punctuation">(</span><span class="token number">30</span> <span class="token operator">*</span> scale<span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        height<span class="token punctuation">:</span> <span class="token number">50</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token macro property">dbg!</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>rect1<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><pre><code>[4.rs:10:16] 30 * scale = 60
[4.rs:14:5] &amp;rect1 = Rectangle &#123;
    width: 60,
    height: 50,
&#125;
</code></pre>
<p>这下就全都有了</p>
<h2 id="枚举"><a class="anchor" href="#枚举">#</a> 枚举</h2>
<h3 id="枚举-2"><a class="anchor" href="#枚举-2">#</a> 枚举：</h3>
<p>例子：</p>
<p>枚举 (enum 或 enumeration) 允许你通过列举可能的成员来定义一个<strong>枚举类型</strong>，例如扑克牌花色：</p>
<figure class="highlight rust"><figcaption data-lang="rust"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">enum</span> <span class="token type-definition class-name">PokerSuit</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token class-name">Clubs</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token class-name">Spades</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token class-name">Diamonds</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token class-name">Hearts</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><strong>枚举类型是一个类型，它会包含所有可能的枚举成员，而枚举值是该类型中的具体某个成员的实例。</strong></p>
<h3 id="枚举值"><a class="anchor" href="#枚举值">#</a> 枚举值：</h3>
<p>创建枚举类型的两个成员实例：</p>
<figure class="highlight rust"><figcaption data-lang="rust"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> heart<span class="token operator">=</span><span class="token class-name">PokerSuit</span><span class="token punctuation">::</span><span class="token class-name">Hearts</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">let</span> diamond<span class="token operator">=</span><span class="token class-name">PokerSuit</span><span class="token punctuation">::</span><span class="token class-name">Diamonds</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>我们通过：：操作符来访问 PokerSuit 下的具体成员，从代码可以清晰的看出，heart 和 diamond 都是 PokerSuit 枚举类型的，接着可以定义一个函数来使用他们：</p>
<figure class="highlight rust"><figcaption data-lang="rust"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token attribute attr-name">#[derive(Debug)]</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">enum</span> <span class="token type-definition class-name">PokerSuit</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token class-name">Clubs</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token class-name">Spades</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token class-name">Diamonds</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token class-name">Hearts</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">let</span> heart <span class="token operator">=</span> <span class="token class-name">PokerSuit</span><span class="token punctuation">::</span><span class="token class-name">Hearts</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">let</span> diamond <span class="token operator">=</span> <span class="token class-name">PokerSuit</span><span class="token punctuation">::</span><span class="token class-name">Diamonds</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token function">print_suit</span><span class="token punctuation">(</span>heart<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token function">print_suit</span><span class="token punctuation">(</span>diamond<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">print_suit</span><span class="token punctuation">(</span>card<span class="token punctuation">:</span> <span class="token class-name">PokerSuit</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token comment">// 需要在定义 enum PokerSuit 的上面添加上 #[derive (Debug)]，否则会报 card 没有实现 Debug</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;:?&#125;"</span><span class="token punctuation">,</span>card<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><code>print_suit</code>  函数的参数类型是  <code>PokerSuit</code> ，因此我们可以把  <code>heart</code>  和  <code>diamond</code>  传给它，虽然  <code>heart</code>  是基于  <code>PokerSuit</code>  下的  <code>Hearts</code>  成员实例化的，但是它是货真价实的  <code>PokerSuit</code>  枚举类型。</p>
<p>接下来，我们想让扑克牌变得更加实用，那么需要给每张牌赋予一个值： <code>A</code> (1)- <code>K</code>  (13)，这样再加上花色，就是一张真实的扑克牌了，例如红心 A。</p>
<p>目前来说，枚举值还不能带有值，因此先用结构体来实现：</p>
<figure class="highlight rust"><figcaption data-lang="rust"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">enum</span> <span class="token type-definition class-name">PokerSuit</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token class-name">Clubs</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token class-name">Spades</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token class-name">Diamonds</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token class-name">Hearts</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">struct</span> <span class="token type-definition class-name">PokerCard</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    suit<span class="token punctuation">:</span> <span class="token class-name">PokerSuit</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    value<span class="token punctuation">:</span> <span class="token keyword">u8</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>   <span class="token keyword">let</span> c1 <span class="token operator">=</span> <span class="token class-name">PokerCard</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>       suit<span class="token punctuation">:</span> <span class="token class-name">PokerSuit</span><span class="token punctuation">::</span><span class="token class-name">Clubs</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="16"></td><td><pre>       value<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="17"></td><td><pre>   <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>   <span class="token keyword">let</span> c2 <span class="token operator">=</span> <span class="token class-name">PokerCard</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>       suit<span class="token punctuation">:</span> <span class="token class-name">PokerSuit</span><span class="token punctuation">::</span><span class="token class-name">Diamonds</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="20"></td><td><pre>       value<span class="token punctuation">:</span> <span class="token number">12</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="21"></td><td><pre>   <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>还有更简单的写法：</p>
<figure class="highlight rust"><figcaption data-lang="rust"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">enum</span> <span class="token type-definition class-name">PokerCard</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token class-name">Clubs</span><span class="token punctuation">(</span><span class="token keyword">u8</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token class-name">Spades</span><span class="token punctuation">(</span><span class="token keyword">u8</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token class-name">Diamonds</span><span class="token punctuation">(</span><span class="token keyword">u8</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token class-name">Hearts</span><span class="token punctuation">(</span><span class="token keyword">u8</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>   <span class="token keyword">let</span> c1 <span class="token operator">=</span> <span class="token class-name">PokerCard</span><span class="token punctuation">::</span><span class="token class-name">Spades</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>   <span class="token keyword">let</span> c2 <span class="token operator">=</span> <span class="token class-name">PokerCard</span><span class="token punctuation">::</span><span class="token class-name">Diamonds</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>再复杂一点：</p>
<figure class="highlight rust"><figcaption data-lang="rust"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">struct</span> <span class="token type-definition class-name">Ipv4Addr</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token comment">// --snip--</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">struct</span> <span class="token type-definition class-name">Ipv6Addr</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token comment">// --snip--</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">enum</span> <span class="token type-definition class-name">IpAddr</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token constant">V4</span><span class="token punctuation">(</span><span class="token class-name">Ipv4Addr</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token constant">V6</span><span class="token punctuation">(</span><span class="token class-name">Ipv6Addr</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>这里面就是 Ipv4Addr，Ipv6Addr 之类的结构体来定义两种不同的 IP 数据。</p>
<p>这样证明：任何类型的数据都可以放入枚举成员中</p>
<p>增加一些挑战？先看以下代码：</p>
<figure class="highlight rust"><figcaption data-lang="rust"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">enum</span> <span class="token type-definition class-name">Message</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token class-name">Quit</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token class-name">Move</span> <span class="token punctuation">&#123;</span> x<span class="token punctuation">:</span> <span class="token keyword">i32</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token keyword">i32</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token class-name">Write</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token class-name">ChangeColor</span><span class="token punctuation">(</span><span class="token keyword">i32</span><span class="token punctuation">,</span> <span class="token keyword">i32</span><span class="token punctuation">,</span> <span class="token keyword">i32</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">let</span> m1 <span class="token operator">=</span> <span class="token class-name">Message</span><span class="token punctuation">::</span><span class="token class-name">Quit</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">let</span> m2 <span class="token operator">=</span> <span class="token class-name">Message</span><span class="token punctuation">::</span><span class="token class-name">Move</span><span class="token punctuation">&#123;</span>x<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">,</span>y<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token keyword">let</span> m3 <span class="token operator">=</span> <span class="token class-name">Message</span><span class="token punctuation">::</span><span class="token class-name">ChangeColor</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>该枚举类型代表一条消息，它包含四个不同的成员：</p>
<ul>
<li><code>Quit</code>  没有任何关联数据</li>
<li><code>Move</code>  包含一个匿名结构体</li>
<li><code>Write</code>  包含一个  <code>String</code>  字符串</li>
<li><code>ChangeColor</code>  包含三个  <code>i32</code></li>
</ul>
<p>当然，我们也可以用结构体的方式来定义这些消息：</p>
<figure class="highlight rust"><figcaption data-lang="rust"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">struct</span> <span class="token type-definition class-name">QuitMessage</span><span class="token punctuation">;</span> <span class="token comment">// 单元结构体</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">struct</span> <span class="token type-definition class-name">MoveMessage</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    x<span class="token punctuation">:</span> <span class="token keyword">i32</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    y<span class="token punctuation">:</span> <span class="token keyword">i32</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">struct</span> <span class="token type-definition class-name">WriteMessage</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 元组结构体</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">struct</span> <span class="token type-definition class-name">ChangeColorMessage</span><span class="token punctuation">(</span><span class="token keyword">i32</span><span class="token punctuation">,</span> <span class="token keyword">i32</span><span class="token punctuation">,</span> <span class="token keyword">i32</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 元组结构体</span></pre></td></tr></table></figure><p>由于每个结构体都有自己的类型，因此我们无法在需要同一类型的地方进行使用，例如某个函数它的功能是接受消息并进行发送，那么用枚举的方式，就可以接收不同的消息，但是用结构体，该函数无法接受 4 个不同的结构体作为参数。</p>
<p>而且从代码规范角度来看，枚举的实现更简洁，代码内聚性更强，不像结构体的实现，分散在各个地方。</p>
<h3 id="同一化类型"><a class="anchor" href="#同一化类型">#</a> 同一化类型：</h3>
<p>最后，再用一个实际项目中的简化片段，来结束枚举类型的语法学习。</p>
<p>例如我们有一个 WEB 服务，需要接受用户的长连接，假设连接有两种： <code>TcpStream</code>  和  <code>TlsStream</code> ，但是我们希望对这两个连接的处理流程相同，也就是用同一个函数来处理这两个连接，代码如下：</p>
<figure class="highlight rust"><figcaption data-lang="rust"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">new</span> <span class="token punctuation">(</span>stream<span class="token punctuation">:</span> <span class="token class-name">TcpStream</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token keyword">let</span> <span class="token keyword">mut</span> s <span class="token operator">=</span> stream<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token keyword">if</span> tls <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    s <span class="token operator">=</span> <span class="token function">negotiate_tls</span><span class="token punctuation">(</span>stream<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token comment">//websocket 是一个 WebSocket&lt;TcpStream > 或者</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token comment">//   WebSocket&lt;native_tls::TlsStream&lt;TcpStream>> 类型</span></pre></td></tr><tr><td data-num="9"></td><td><pre>  websocket <span class="token operator">=</span> <span class="token class-name">WebSocket</span><span class="token punctuation">::</span><span class="token function">from_raw_socket</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    s<span class="token punctuation">,</span> <span class="token punctuation">...</span><span class="token punctuation">...</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>此时，枚举类型就能帮上大忙：</p>
<figure class="highlight rust"><figcaption data-lang="rust"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">enum</span> <span class="token type-definition class-name">Websocket</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token class-name">Tcp</span><span class="token punctuation">(</span><span class="token class-name">Websocket</span><span class="token operator">&lt;</span><span class="token class-name">TcpStream</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token class-name">Tls</span><span class="token punctuation">(</span><span class="token class-name">Websocket</span><span class="token operator">&lt;</span><span class="token namespace">native_tls<span class="token punctuation">::</span></span><span class="token class-name">TlsStream</span><span class="token operator">&lt;</span><span class="token class-name">TcpStream</span><span class="token operator">>></span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id="option枚举用于处理空值"><a class="anchor" href="#option枚举用于处理空值">#</a> option 枚举用于处理空值：</h3>
<p>在其它编程语言中，往往都有一个  <code>null</code>  关键字，该关键字用于表明一个变量当前的值为空（不是零值，例如整型的零值是 0），也就是不存在值。当你对这些  <code>null</code>  进行操作时，例如调用一个方法，就会直接抛出 <strong>null 异常</strong>，导致程序的崩溃，因此我们在编程时需要格外的小心去处理这些  <code>null</code>  空值。</p>
<h5 id="rust-的做法-optiont"><a class="anchor" href="#rust-的做法-optiont">#</a> Rust 的做法 ——  <code>Option&lt;T&gt;</code></h5>
<p>Rust 直接<strong>去掉了  <code>null</code> </strong>，用  <code>Option&lt;T&gt;</code>  这个枚举类型来表示 “可能有值，也可能没值” 的情况。</p>
<pre><code>rust复制编辑enum Option&lt;T&gt; &#123;
    Some(T), // 代表有值
    None,    // 代表没有值
&#125;
</code></pre>
<ul>
<li><code>Some(T)</code>  代表有值，比如  <code>Some(5)</code>  就表示  <code>5</code>  这个数。</li>
<li><code>None</code>  代表没有值，相当于  <code>null</code> ，但它是  <code>Option&lt;T&gt;</code>  类型的一部分，不能直接使用。</li>
</ul>
<p>Rust 这样设计的好处是：<strong>你必须显式处理可能的空值，防止程序出错！</strong></p>
<h5 id="例子定义-optiont-变量"><a class="anchor" href="#例子定义-optiont-变量">#</a> 例子：定义  <code>Option&lt;T&gt;</code>  变量</h5>
<pre><code>rust复制编辑let some_number = Some(5);
let some_string = Some(&quot;Hello&quot;);

let absent_number: Option&lt;i32&gt; = None; // 需要指定类型
</code></pre>
<p>如果是  <code>None</code> ，Rust 需要知道  <code>Option&lt;T&gt;</code>  的  <code>T</code>  是什么类型，比如  <code>Option&lt;i32&gt;</code> ，否则它不知道  <code>None</code>  代表什么类型。</p>
<h5 id="为什么-optiont-比-null-好"><a class="anchor" href="#为什么-optiont-比-null-好">#</a> 为什么  <code>Option&lt;T&gt;</code>  比  <code>null</code>  好？</h5>
<p>因为 <strong> <code>Option&lt;T&gt;</code>  和  <code>T</code>  是不同的类型</strong>，Rust 不允许直接把  <code>Option&lt;T&gt;</code>  当作普通值使用，这样能防止你意外访问  <code>None</code> 。</p>
<p>来看这个例子：</p>
<pre><code>rust复制编辑let x: i8 = 5;
let y: Option&lt;i8&gt; = Some(5);

let sum = x + y; // ❌ 不能直接相加！
</code></pre>
<p>错误信息：</p>
<pre><code>rust


复制编辑
no implementation for `i8 + Option&lt;i8&gt;`
</code></pre>
<p>Rust 不允许直接把  <code>Option&lt;i8&gt;</code>  当作  <code>i8</code> ，必须先处理  <code>Option</code> ，确保它有值。</p>
<h5 id="如何取出-optiont-的值"><a class="anchor" href="#如何取出-optiont-的值">#</a> 如何取出  <code>Option&lt;T&gt;</code>  的值？</h5>
<p>你必须<strong>显式地</strong>告诉 Rust 如何处理  <code>None</code> ，避免程序崩溃。可以用  <code>match</code>  语句来处理：</p>
<pre><code>rust复制编辑fn plus_one(x: Option&lt;i32&gt;) -&gt; Option&lt;i32&gt; &#123;
    match x &#123;
        Some(i) =&gt; Some(i + 1), // 有值时 +1
        None =&gt; None,            // 没有值，返回 None
    &#125;
&#125;

let five = Some(5);
let six = plus_one(five); // six 是 Some(6)
let none = plus_one(None); // 仍然是 None
</code></pre>
<p>这里  <code>match</code>  确保了：</p>
<ul>
<li>如果  <code>x</code>  里有值（ <code>Some(i)</code> ），就加 1。</li>
<li>如果  <code>x</code>  是  <code>None</code> ，就保持  <code>None</code> ，避免出错。</li>
</ul>
<h2 id="数组"><a class="anchor" href="#数组">#</a> 数组</h2>
<p>两种数组：第一种是速度快但是长度固定的 array，一种是可动态增长的 Vector（动态数组）</p>
<p>这两个跟 &amp; str 和 String 很像</p>
<p>数组的三要素：</p>
<pre><code>长度固定
元素必须有相同的类型
依次线性排列
</code></pre>
<p>数组越界会直接报错</p>
<p>数组的赋值：</p>
<figure class="highlight rust"><figcaption data-lang="rust"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">i32</span><span class="token punctuation">:</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//let a:[i32;3]=[4,4,4];</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">[</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token number">4</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token number">4</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token number">4</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">]</span></pre></td></tr></table></figure><p>这里仅限于基础类型，如果是复杂类型</p>
<p>就得这样写：</p>
<figure class="highlight rust"><figcaption data-lang="rust"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> array <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"rust is good!"</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"rust is good!"</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"rust is good!"</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;:#?&#125;"</span><span class="token punctuation">,</span> array<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>也可以调用 std::array::from_fn</p>
<figure class="highlight rust"><figcaption data-lang="rust"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> array<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token class-name">String</span><span class="token punctuation">;</span><span class="token number">8</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>array<span class="token punctuation">::</span></span><span class="token function">from_fn</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>_i<span class="token closure-punctuation punctuation">|</span></span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"rust is good!"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;:#?&#125;"</span><span class="token punctuation">,</span>array<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">[</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token string">"rust is good!"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token string">"rust is good!"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token string">"rust is good!"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token string">"rust is good!"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token string">"rust is good!"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token string">"rust is good!"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token string">"rust is good!"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token string">"rust is good!"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">]</span></pre></td></tr></table></figure><h3 id="数组切片"><a class="anchor" href="#数组切片">#</a> 数组切片：</h3>
<figure class="highlight rust"><figcaption data-lang="rust"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">let</span> a<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token keyword">i32</span><span class="token punctuation">;</span> <span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">let</span> slice<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">i32</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">&amp;</span>a<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">..</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>slice<span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h2 id="流程控制"><a class="anchor" href="#流程控制">#</a> 流程控制</h2>
<p>语法:</p>
<figure class="highlight rust"><figcaption data-lang="rust"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">if</span> condition<span class="token operator">==</span><span class="token boolean">true</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">//A...</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">//B...</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>但是 if 和 else 返回值不统一时会报错（用 if 赋值时）</p>
<figure class="highlight rust"><figcaption data-lang="rust"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">if</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token keyword">else</span></pre></td></tr></table></figure><p>for 循环：</p>
<figure class="highlight rust"><figcaption data-lang="rust"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token number">1</span><span class="token punctuation">..=</span><span class="token number">5</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure>
      <div class="tags">
          <a href="/tags/buuctf/" rel="tag"><i class="ic i-tag"></i> buuctf</a>
          <a href="/tags/rust/" rel="tag"><i class="ic i-tag"></i> rust</a>
      </div>
  </div>

   <footer>

    <div class="meta">
  <span class="item">
    <span class="icon">
      <i class="ic i-calendar-check"></i>
    </span>
    <span class="text">Edited on</span>
    <time title="Modified: 2025-04-07 22:28:28" itemprop="dateModified" datetime="2025-04-07T22:28:28+08:00">2025-04-07</time>
  </span>
</div>

      
<div class="reward">
  <button><i class="ic i-heartbeat"></i> Donate</button>
  <p>Give me a cup of [coffee]~(￣▽￣)~*</p>
  <div id="qr">
      
      <div>
        <img data-src="/images/wechatpay.png" alt="odiws WeChat Pay">
        <p>WeChat Pay</p>
      </div>
      
      <div>
        <img data-src="/images/alipay.png" alt="odiws Alipay">
        <p>Alipay</p>
      </div>
      
      <div>
        <img data-src="/images/paypal.png" alt="odiws PayPal">
        <p>PayPal</p>
      </div>
  </div>
</div>

      

<div id="copyright">
<ul>
  <li class="author">
    <strong>Post author:  </strong>odiws <i class="ic i-at"><em>@</em></i>Hexo
  </li>
  <li class="link">
    <strong>Post link: </strong>
    <a href="http://odiws.github.io/2025/03/28/rust%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" title="rust学习笔记">http://odiws.github.io/2025/03/28/rust学习笔记/</a>
  </li>
  <li class="license">
    <strong>Copyright Notice:  </strong>All articles in this blog are licensed under <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> unless stating additionally.
  </li>
</ul>
</div>

  </footer>

</article>

  </div>
  

<div class="post-nav">
    <div class="item left">
      

  <a href="/2025/03/25/Nctf-web%E9%83%A8%E5%88%86%E5%A4%8D%E7%8E%B0/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;www.loliapi.com&#x2F;acg&#x2F;?553458" title="Nctf_web部分复现">
  <span class="type">Previous Post</span>
  <span class="category"><i class="ic i-flag"></i> 比赛复现</span>
  <h3>Nctf_web部分复现</h3>
  </a>

    </div>
    <div class="item right">
      

  <a href="/2025/04/07/http%E8%AF%B7%E6%B1%82%E8%B5%B0%E7%A7%81%E6%BC%8F%E6%B4%9E/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;www.loliapi.com&#x2F;acg&#x2F;?247611" title="http请求走私漏洞">
  <span class="type">Next Post</span>
  <span class="category"><i class="ic i-flag"></i> </span>
  <h3>http请求走私漏洞</h3>
  </a>

    </div>
</div>

  
  <div class="wrap" id="comments"></div>


        </div>
        <div id="sidebar">
          

<div class="inner">

  <div class="panels">
    <div class="inner">
      <div class="contents panel pjax" data-title="Contents">
          <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#rust%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0"><span class="toc-number">1.</span> <span class="toc-text"> Rust 学习笔记</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%98%E9%87%8F%E5%A3%B0%E6%98%8E"><span class="toc-number">1.1.</span> <span class="toc-text"> 变量声明：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E5%80%BC%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.2.</span> <span class="toc-text"> 数值类型：</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B4%E6%95%B0%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.2.1.</span> <span class="toc-text"> 整数类型：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B5%AE%E7%82%B9%E5%9E%8B"><span class="toc-number">1.2.2.</span> <span class="toc-text"> 浮点型：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%90%E7%AE%97"><span class="toc-number">1.2.3.</span> <span class="toc-text"> 运算:</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%8D%E8%BF%90%E7%AE%97"><span class="toc-number">1.2.4.</span> <span class="toc-text"> 位运算：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BA%8F%E5%88%97"><span class="toc-number">1.2.5.</span> <span class="toc-text"> 序列（***）：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#as%E5%AE%8C%E6%88%90%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2"><span class="toc-number">1.2.6.</span> <span class="toc-text"> AS 完成类型转换：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E5%B8%83%E5%B0%94%E5%8D%95%E5%85%83%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.2.7.</span> <span class="toc-text"> 字符，布尔，单元类型：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%AD%E5%8F%A5%E4%B8%8E%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="toc-number">1.2.8.</span> <span class="toc-text"> 语句与表达式：</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%BD%E6%95%B0"><span class="toc-number">2.</span> <span class="toc-text"> 函数：</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%80%E6%9C%89%E6%9D%83%E4%B8%8E%E5%80%9F%E7%94%A8"><span class="toc-number">2.1.</span> <span class="toc-text"> 所有权与借用：</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%80%E6%9C%89%E6%9D%83"><span class="toc-number">2.1.1.</span> <span class="toc-text"> 所有权：</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%A0%88%E4%B8%8E%E5%A0%86"><span class="toc-number">2.1.1.1.</span> <span class="toc-text"> 栈与堆：</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%A0%88"><span class="toc-number">2.1.1.1.1.</span> <span class="toc-text"> 栈：</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%A0%86"><span class="toc-number">2.1.1.1.2.</span> <span class="toc-text"> 堆：</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%80%A7%E8%83%BD%E5%8C%BA%E5%88%AB"><span class="toc-number">2.1.1.1.3.</span> <span class="toc-text"> 性能区别：</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%89%80%E6%9C%89%E6%9D%83%E4%B8%8E%E5%A0%86%E6%A0%88"><span class="toc-number">2.1.1.1.4.</span> <span class="toc-text"> 所有权与堆栈</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%89%80%E6%9C%89%E6%9D%83%E5%8E%9F%E5%88%99"><span class="toc-number">2.1.1.2.</span> <span class="toc-text"> 所有权原则：</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8F%98%E9%87%8F%E7%BB%91%E5%AE%9A%E8%83%8C%E5%90%8E%E7%9A%84%E6%95%B0%E6%8D%AE%E4%BA%A4%E4%BA%92"><span class="toc-number">2.1.1.2.1.</span> <span class="toc-text"> 变量绑定背后的数据交互：</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%95%E7%94%A8%E4%B8%8E%E8%A7%A3%E5%BC%95%E7%94%A8"><span class="toc-number">2.1.2.</span> <span class="toc-text"> 引用与解引用</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E4%B8%8D%E5%8F%AF%E5%8F%98%E5%BC%95%E7%94%A8"><span class="toc-number">2.1.2.0.1.</span> <span class="toc-text"> 不可变引用：</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8F%AF%E5%8F%98%E5%BC%95%E7%94%A8"><span class="toc-number">2.1.2.0.2.</span> <span class="toc-text"> 可变引用：</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%BF%99%E4%B8%A4%E8%80%85%E7%9A%84%E5%8C%BA%E5%88%AB%E4%B8%8E%E8%81%94%E7%B3%BB"><span class="toc-number">2.1.2.0.3.</span> <span class="toc-text"> 这两者的区别与联系:</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%82%AC%E5%9E%82%E5%BC%95%E7%94%A8dangling-references"><span class="toc-number">2.2.</span> <span class="toc-text"> 悬垂引用 (Dangling References)</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%80%9F%E7%94%A8%E8%A7%84%E5%88%99%E6%80%BB%E7%BB%93"><span class="toc-number">2.2.0.0.1.</span> <span class="toc-text"> 借用规则总结</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%8D%E5%90%88%E7%B1%BB%E5%9E%8B"><span class="toc-number">2.3.</span> <span class="toc-text"> 复合类型：</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%B8%8E%E5%88%87%E7%89%87"><span class="toc-number">2.3.1.</span> <span class="toc-text"> 字符串与切片：</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="toc-number">2.3.1.1.</span> <span class="toc-text"> 字符串：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%87%E7%89%87"><span class="toc-number">2.3.1.2.</span> <span class="toc-text"> 切片：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#string%E4%B8%8Estr%E7%9A%84%E8%BD%AC%E6%8D%A2"><span class="toc-number">2.3.1.3.</span> <span class="toc-text"> String 与 &amp; str 的转换：</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%B4%A2%E5%BC%95"><span class="toc-number">2.3.2.</span> <span class="toc-text"> 字符串索引</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B7%B1%E5%85%A5%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%86%85%E9%83%A8"><span class="toc-number">2.3.3.</span> <span class="toc-text"> 深入字符串内部</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9A%84%E4%B8%8D%E5%90%8C%E8%A1%A8%E7%8E%B0%E5%BD%A2%E5%BC%8F"><span class="toc-number">2.3.4.</span> <span class="toc-text"> 字符串的不同表现形式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%88%87%E7%89%87"><span class="toc-number">2.3.5.</span> <span class="toc-text"> 字符串切片</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%93%8D%E4%BD%9C"><span class="toc-number">2.4.</span> <span class="toc-text"> 字符串操作（***）：</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%BD%E5%8A%A0-push"><span class="toc-number">2.4.1.</span> <span class="toc-text"> 追加 (Push)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8F%92%E5%85%A5-insert"><span class="toc-number">2.4.2.</span> <span class="toc-text"> 插入 (Insert)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9B%BF%E6%8D%A2-replace"><span class="toc-number">2.4.3.</span> <span class="toc-text"> 替换 (Replace)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A0%E9%99%A4-delete"><span class="toc-number">2.4.4.</span> <span class="toc-text"> 删除 (Delete)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%9E%E6%8E%A5-concatenate"><span class="toc-number">2.4.5.</span> <span class="toc-text"> 连接 (Concatenate)</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%BD%AC%E4%B9%89"><span class="toc-number">2.5.</span> <span class="toc-text"> 字符串转义：</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6"><span class="toc-number">2.5.1.</span> <span class="toc-text"> 字符</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%97%E8%8A%82"><span class="toc-number">2.5.2.</span> <span class="toc-text"> 字节</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%AD%90%E4%B8%B2"><span class="toc-number">2.5.3.</span> <span class="toc-text"> 获取子串</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%B7%B1%E5%BA%A6%E5%89%96%E6%9E%90"><span class="toc-number">2.6.</span> <span class="toc-text"> 字符串深度剖析</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%83%E7%BB%84"><span class="toc-number">3.</span> <span class="toc-text"> 元组：</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95"><span class="toc-number">3.0.1.</span> <span class="toc-text"> 语法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A8%A1%E5%BC%8F%E5%8C%B9%E9%85%8D"><span class="toc-number">3.0.2.</span> <span class="toc-text"> 模式匹配：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%A8%E8%AE%BF%E9%97%AE%E5%85%83%E7%BB%84"><span class="toc-number">3.0.3.</span> <span class="toc-text"> 用。访问元组</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%93%E6%9E%84%E4%BD%93"><span class="toc-number">4.</span> <span class="toc-text"> 结构体</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-2"><span class="toc-number">4.0.1.</span> <span class="toc-text"> 语法:</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%A8%E8%AE%BF%E9%97%AE%E7%BB%93%E6%9E%84%E4%BD%93%E5%AD%97%E6%AE%B5"><span class="toc-number">4.0.2.</span> <span class="toc-text"> 用。访问结构体字段：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AE%80%E5%8C%96%E7%BB%93%E6%9E%84%E4%BD%93%E5%88%9B%E5%BB%BA"><span class="toc-number">4.0.3.</span> <span class="toc-text"> 简化结构体创建：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%93%E6%9E%84%E4%BD%93%E6%9B%B4%E6%96%B0%E8%AF%AD%E6%B3%95"><span class="toc-number">4.0.4.</span> <span class="toc-text"> 结构体更新语法：</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E9%9C%80%E8%A6%81%E6%B3%A8%E6%84%8F%E7%9A%84%E6%98%AF-user1-%E5%BF%85%E9%A1%BB%E5%9C%A8%E7%BB%93%E6%9E%84%E4%BD%93%E7%9A%84%E5%B0%BE%E9%83%A8%E4%BD%BF%E7%94%A8"><span class="toc-number">4.0.4.0.1.</span> <span class="toc-text"> 需要注意的是  ..user1  必须在结构体的尾部使用。</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%93%E6%9E%84%E4%BD%93%E7%9A%84%E5%86%85%E5%AD%98%E6%8E%92%E5%88%97"><span class="toc-number">4.0.5.</span> <span class="toc-text"> 结构体的内存排列：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%83%E7%BB%84%E7%BB%93%E6%9E%84%E4%BD%93"><span class="toc-number">4.1.</span> <span class="toc-text"> 元组结构体：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%95%E5%85%83%E7%BB%93%E6%9E%84%E4%BD%93"><span class="toc-number">4.2.</span> <span class="toc-text"> 单元结构体：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9E%9A%E4%B8%BE"><span class="toc-number">5.</span> <span class="toc-text"> 枚举</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%9A%E4%B8%BE-2"><span class="toc-number">5.1.</span> <span class="toc-text"> 枚举：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%9A%E4%B8%BE%E5%80%BC"><span class="toc-number">5.2.</span> <span class="toc-text"> 枚举值：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%8C%E4%B8%80%E5%8C%96%E7%B1%BB%E5%9E%8B"><span class="toc-number">5.3.</span> <span class="toc-text"> 同一化类型：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#option%E6%9E%9A%E4%B8%BE%E7%94%A8%E4%BA%8E%E5%A4%84%E7%90%86%E7%A9%BA%E5%80%BC"><span class="toc-number">5.4.</span> <span class="toc-text"> option 枚举用于处理空值：</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#rust-%E7%9A%84%E5%81%9A%E6%B3%95-optiont"><span class="toc-number">5.4.0.1.</span> <span class="toc-text"> Rust 的做法 ——  Option&lt;T&gt;</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BE%8B%E5%AD%90%E5%AE%9A%E4%B9%89-optiont-%E5%8F%98%E9%87%8F"><span class="toc-number">5.4.0.2.</span> <span class="toc-text"> 例子：定义  Option&lt;T&gt;  变量</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88-optiont-%E6%AF%94-null-%E5%A5%BD"><span class="toc-number">5.4.0.3.</span> <span class="toc-text"> 为什么  Option&lt;T&gt;  比  null  好？</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%8F%96%E5%87%BA-optiont-%E7%9A%84%E5%80%BC"><span class="toc-number">5.4.0.4.</span> <span class="toc-text"> 如何取出  Option&lt;T&gt;  的值？</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E7%BB%84"><span class="toc-number">6.</span> <span class="toc-text"> 数组</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E7%BB%84%E5%88%87%E7%89%87"><span class="toc-number">6.1.</span> <span class="toc-text"> 数组切片：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6"><span class="toc-number">7.</span> <span class="toc-text"> 流程控制</span></a></li></ol>
      </div>
      <div class="related panel pjax" data-title="Related">
        <ul>
          <li><a href="/2025/02/19/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" rel="bookmark" title="java反序列化学习笔记">java反序列化学习笔记</a></li><li class="active"><a href="/2025/03/28/rust%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" rel="bookmark" title="rust学习笔记">rust学习笔记</a></li>
        </ul>
      </div>
      <div class="overview panel" data-title="Overview">
        <div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <img class="image" itemprop="image" alt="odiws"
      data-src="/images/avatar.jpg">
  <p class="name" itemprop="name">odiws</p>
  <div class="description" itemprop="description"></div>
</div>

<nav class="state">
    <div class="item posts">
      <a href="/archives/">
        <span class="count">34</span>
        <span class="name">posts</span>
      </a>
    </div>
    <div class="item categories">
      <a href="/categories/">
        <span class="count">9</span>
        <span class="name">categories</span>
      </a>
    </div>
    <div class="item tags">
      <a href="/tags/">
        <span class="count">30</span>
        <span class="name">tags</span>
      </a>
    </div>
</nav>

<div class="social">
</div>

<ul class="menu">
  
    
  <li class="item">
    <a href="/" rel="section"><i class="ic i-home"></i>Home</a>
  </li>


</ul>

      </div>
    </div>
  </div>

  <ul id="quick">
    <li class="prev pjax">
        <a href="/2025/03/25/Nctf-web%E9%83%A8%E5%88%86%E5%A4%8D%E7%8E%B0/" rel="prev" title="Previous Post"><i class="ic i-chevron-left"></i></a>
    </li>
    <li class="up"><i class="ic i-arrow-up"></i></li>
    <li class="down"><i class="ic i-arrow-down"></i></li>
    <li class="next pjax">
        <a href="/2025/04/07/http%E8%AF%B7%E6%B1%82%E8%B5%B0%E7%A7%81%E6%BC%8F%E6%B4%9E/" rel="next" title="Next Post"><i class="ic i-chevron-right"></i></a>
    </li>
    <li class="percent"></li>
  </ul>
</div>


        </div>
        <div class="dimmer"></div>
      </div>
    </main>
    <footer id="footer">
      <div class="inner">
        <div class="widgets">
          
<div class="rpost pjax">
  <h2>Random Posts</h2>
  <ul>
      
  <li class="item">
    
<div class="breadcrumb">
</div>

    <span><a href="/2025/04/23/Spring-MVC/" title="Spring_MVC">Spring_MVC</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/misc/" title="In misc">misc</a>
</div>

    <span><a href="/2025/05/06/SWPU2019-%E4%BC%9F%E5%A4%A7%E7%9A%84%E4%BE%A6%E6%8E%A2/" title="[SWPU2019]伟大的侦探">[SWPU2019]伟大的侦探</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/%E5%88%B7%E9%A2%98%E7%AC%94%E8%AE%B0/" title="In 刷题笔记">刷题笔记</a>
</div>

    <span><a href="/2024/07/25/2019-Web-Unagi/" title="[CSAWQual2019]Web_Unagi">[CSAWQual2019]Web_Unagi</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/%E5%88%B7%E9%A2%98%E7%AC%94%E8%AE%B0/" title="In 刷题笔记">刷题笔记</a>
</div>

    <span><a href="/2025/02/26/HMGCTF2022-Fan-Website/" title="[HMGCTF2022]Fan_Website">[HMGCTF2022]Fan_Website</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/misc/" title="In misc">misc</a>
</div>

    <span><a href="/2025/05/06/GXYCTF2019-gakki/" title="[GXYCTF2019]gakki">[GXYCTF2019]gakki</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" title="In 学习笔记">学习笔记</a>
</div>

    <span><a href="/2025/02/19/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" title="java反序列化学习笔记">java反序列化学习笔记</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/%E5%88%B7%E9%A2%98%E7%AC%94%E8%AE%B0/" title="In 刷题笔记">刷题笔记</a>
</div>

    <span><a href="/2024/04/28/3-txt/" title="buuctf4月27日">buuctf4月27日</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/%E5%88%B7%E9%A2%98%E7%AC%94%E8%AE%B0/" title="In 刷题笔记">刷题笔记</a>
</div>

    <span><a href="/2025/03/18/JMCTF-2021-GoOSS/" title="[JMCTF_2021]GoOSS">[JMCTF_2021]GoOSS</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/%E6%AF%94%E8%B5%9B%E5%A4%8D%E7%8E%B0/" title="In 比赛复现">比赛复现</a>
</div>

    <span><a href="/2025/03/25/Nctf-web%E9%83%A8%E5%88%86%E5%A4%8D%E7%8E%B0/" title="Nctf_web部分复现">Nctf_web部分复现</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/%E5%88%B7%E9%A2%98%E7%AC%94%E8%AE%B0/" title="In 刷题笔记">刷题笔记</a>
</div>

    <span><a href="/2024/07/29/ISITDTU2019-EasyPHP/" title="[羊城杯2020]easyphp">[羊城杯2020]easyphp</a></span>
  </li>

  </ul>
</div>
<div>
  <h2>Recent Comments</h2>
  <ul class="leancloud-recent-comment"></ul>
</div>

        </div>
        <div class="status">
  <div class="copyright">
    
    &copy; 2010 – 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="ic i-sakura rotate"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">odiws @ zty153’s_blog</span>
  </div>
  <div class="powered-by">
    Powered by <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span>
  </div>
</div>

      </div>
    </footer>
  </div>
<script data-config type="text/javascript">
  var LOCAL = {
    path: '2025/03/28/rust学习笔记/',
    favicon: {
      show: "（●´3｀●）Goooood",
      hide: "(´Д｀)Booooom"
    },
    search : {
      placeholder: "Search for Posts",
      empty: "We didn't find any results for the search: ${query}",
      stats: "${hits} results found in ${time} ms"
    },
    valine: true,fancybox: true,
    copyright: 'Copied to clipboard successfully! <br> All articles in this blog are licensed under <i class="ic i-creative-commons"></i>BY-NC-SA.',
    ignores : [
      function(uri) {
        return uri.includes('#');
      },
      function(uri) {
        return new RegExp(LOCAL.path+"$").test(uri);
      }
    ]
  };
</script>

<script src="https://cdn.polyfill.io/v2/polyfill.js"></script>

<script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script>

<script src="/js/app.js?v=0.2.5"></script>




</body>
</html>
